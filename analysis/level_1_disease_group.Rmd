---
title: "Level 1 Disease Trait Grouping"
author: "Isobel Beasley"
date: "2025-09-08"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---


# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(ggplot2)
library(stringr)

```

```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_study_info_trait_ontology_info.csv"))

```

# Initial summary

## Objectives of this analysis:

Level 1 disease grouping: 
-   collapse disease causes, e.g. contact dermatitis due to nickel to contact dermatitis
-   collapse disease subtypes, e.g. bipolar I and bipolar II to bipolar disorder
-   collapse disease onset times, e.g. early-onset alzheimers disease and late-onset alzheimers disease to alzheimers disease
-   collapse disease stages


## Grouping - level 1 set up 

```{r group_l1}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = collected_all_disease_terms)


```

## Initial summary - number of unique study terns 

```{r}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(collected_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(collected_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))

head(n_studies_trait)

dim(n_studies_trait)

```

### When separate studies with multiple terms 

```{r}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$collected_all_disease_terms)  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

```

# Disease cause grouping

## Contact dermatitis

```{r}


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "contact dermatitis due to nickel",
                          "contact dermatitis"
         ))



```

# Disease subtype grouping (non-cancer)

## Ontology help - for getting disease subtypes

```{r ontology_fns}


library(httr)
library(jsonlite)


get_descendants <- function(url){
  
  terms <- c()

repeat {
  res <- GET(url)
  stop_for_status(res)
  data <- fromJSON(content(res, as = "text", encoding = "UTF-8"))
  
  terms <- c(terms, data$`_embedded`$terms$label)
  
  # check if there is a next page
  if (!is.null(data$`_links`$`next`$href)) {
    url <- data$`_links`$`next`$href
  } else {
    break
  }
}
  
terms = unlist(terms)
terms = stringr::str_trim(tolower(terms))
terms = unique(terms)
  
print("Number of terms collected:")
print(length(terms))

print("\n Some example terms")
print(terms[1:5])

return(terms)


}


```

## Abortion

```{r pregnancy_loss}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "habitual abortion|abortion",
                          "loss of pregnancy"
         ))
# exact synonyms (to avoid partial matches
# https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_1001491?lang=en

```

## Acute pancreatitis

```{r acute_pancreatitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "asparaginase-induced acute pancreatitis",
                          "acute pancreatitis"
         ))

```

## Alopecia

```{r alopecia}

url<-  "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0004907/descendants"

alopecia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          pattern = paste0(alopecia_terms, collapse = "|"),
                          "alopecia"
         ))


```

## Alcohol-use disorders

```{r alchol_use_disorders}

gwas_study_info = gwas_study_info |>
      mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "alcohol dependence|alcohol withdrawal|alcohol withdrawal delirium|alcohol abuse|alcohol-related disorders delirium",
                            "alcohol-related disorders"
           ))


gwas_study_info = gwas_study_info |>
      mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "alcoholic liver disease|alcoholic liver cirrhosis|alcoholic pancreatitis",
                            "alcohol-induced disorders"
           ))

```

## Allergic contact dermatitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "allergic contact dermatitis of eyelid",
                          "allergic contact dermatitis"
         ))


```

## Allergic rhinitis


```{r allergic_rhinitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "seasonal allergic rhinitis",
                          "allergic rhinitis"
         ))



```

## Asthma

```{r asthma}

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms ,
                            "atopic asthma",
                            "asthma"
           )) |>
    mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms ,
                            "chronic obstructive asthma",
                            "asthma"
           ))

```

## Autoimmune pancreatitis

```{r autoimmune_pancreatitis}

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms ,
                            "autoimmune pancreatitis type 1",
                            "autoimmune pancreatitis"
           )) 


```


## Bipolar disorder

```{r bipolar_disorder}

gwas_study_info = gwas_study_info |> 
    mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "bipolar ii disorder|bipolar i disorder",
                          "bipolar disorder"
         ))

```

## Celiac disease

```{r celiac_disease}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "refractory celiac disease",
                                   "celiac disease"
                          )  
        )


```

## Chronic pancreatitis

```{r chronic_pancreatitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "thiopurine immunosuppressant-induced pancreatitis|non-alcoholic pancreatitis",
                          "chronic pancreatitis"
         ))

```

## Chronic rhinosinusitis 

```{r chronic_rhinosinusitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "chronic rhinosinusitis with nasal polyps",
                          "chronic rhinosinusitis"
         ))

```


## Coronary artery disease

```{r coronary_artery_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001645/descendants"

coronary_artery_disease_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(coronary_artery_disease_terms, collapse = "|"),
                          "coronary artery disease"
         ))


```

## Drug allergy

```{r drug_allergy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "beta-lactam allergy",
                          "drug allergy"
         ))

```

## Food allergy

```{r food_allergy}


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "peanut allergy|milk allergy|egg allergy|wheat allergic reaction",
                          "food allergy"
         ))
```

## Methamphetamine use disorders 

```{r methamphetamine_use_disorders}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "methamphetamine dependence|methamphetamine-induced psychosis",
                          "methamphetamine use disorders"
         ))

```

## Migrane 

```{r migraine}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "migraine disorder|migraine with aura|migraine without aura",
                          "migraine"
         ))

```

## Multiple sclerosis

```{r multiple_sclerosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "relapsing-remitting multiple sclerosis",
                          "multiple sclerosis"
         ))

```

## Photosensitivity disease

```{r photosensitivity_disease}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms ,
                         "phototoxic dermatitis|skin sensitivity to sun",
                         "photosensitivity disease")
        )

```

## Phobic disorder

```{r phobic_disorder}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_1001908/descendants"

phobic_disorder_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          pattern = paste0(phobic_disorder_terms, collapse = "|"),
                          "phobic disorder"
         ))

```

## Hereditary heterochromatosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "hereditary hemochromatosis type 1",
                          "hereditary hemochromatosis"
         ))

```

## Herpes

```{r}


gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "herpes simplex infection",
                                   "herpesviridae infectious disease"
                          )  
        )


```

## Hypertension

```{r}

url <-  "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000537/descendants"

hypertension_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          pattern = paste0(hypertension_terms, collapse = "|"),
                          "hypertension"
         ))

```

## Infertility (female & male)


```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "tubal factor infertility",
                          "female infertility"
                          )) |>
  mutate(l1_all_disease_terms  = 
                  stringr::str_replace_all(l1_all_disease_terms ,
                          "azoospermia",
                          "male infertility"
                          )  )

```

## Infectious disease

### Influenza a (h1n1) (subset of influenza)

```{r}

gwas_study_info = gwas_study_info |>
    mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "influenza a (h1n1)",
                          "influenza"
         ))


```

### Infectious meningitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "bacterial meningitis|pneumococcal meningitis|viral meningitis",
                          "infectious meningitis"
         ))

```

## Liver cirrhosis

## Neuromyelitis optica 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "aqp4-igg-negative neuromyelitis optica|aqp4-igg-positive neuromyelitis optica",
                          "neuromyelitis optica"
         ))

```

## Neurofibromatosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "neurofibromatosis type 1|neurofibromatosis type 2",
                          "neurofibromatosis"
         ))

```


## Obesity

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "morbid obesity|metabolically healthy obesity",
                                   "obesity"
                          )  
        )

```


## Ocular Melanoma

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "uveal melanoma|uveal melanoma disease severity|epithelioid cell uveal melanoma|choroidal melanoma",
                          "ocular melanoma"
         ))

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "ocular melanoma disease severity",
                          "ocular melanoma"
         ))


```

## Rheumatoid arthritis

```{r}

ra_terms <- c("acpa-positive rheumatoid arthritis",
               "acpa-negative rheumatoid arthritis")

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(ra_terms, collapse = "|"),
                                   "rheumatoid arthritis"
                          )  
        )

```

## Scoliosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "adolescent idiopathic scoliosis",
                          "scoliosis")
         )

```

## Sleep apnea 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "sleep apnea during non-rem sleep|sleep apnea during rem sleep|obstructive sleep apnea",
                          "sleep apnea")
  )


```

## Stroke

https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000712?lang=en

```{r}


hemorrhage_terms <- c("intracerebral hemorrhage",
                      "non-lobar intracerebral hemorrhage",
                      "lobar intracerebral hemorrhage")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "stroke outcome|large artery stroke|small vessel stroke|ischemic stroke|stroke disorder|cardioembolic stroke",
                          "stroke")
  )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "post-operative stroke",
                          "post-operative, stroke")
  )

```

## Systemic scleroderma

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000717/descendants"

scleroderma_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          pattern = paste0(scleroderma_terms, collapse = "|"),
                          "systemic scleroderma"
         ))

```

## Tenosynovitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms ,
                         "stenosing tenosynovitis",
                         "tenosynovitis")
        )

```

## Type 1 diabetes

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "latent autoimmune diabetes in adults",
                          "type 1 diabetes"
         ))

```

## Vitamin b deficiency

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "vitamin b12 deficiency anemia",
                          "vitamin b deficiency"
         ))

```

# Disease subtype grouping (cancer)

### Bladder cancer

```{r}

url <-  "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_4007/descendants"

# maybe do uninary bladder cancer instead

bladder_cancer_terms <- get_descendants(url)

bladder_cancer_terms = stringr::str_replace_all(bladder_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(bladder_cancer_terms, collapse = "|"),
                                   "bladder cancer"
                          )  
        )
  
  
```

### Breast cancer

```{r group_breast_cancer}

breast_cancer_terms <- grep("breast cancer", unique(diseases), value = T)

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(breast_cancer_terms, collapse = "|"),
                                   "breast cancer"
                          )  
        ) |>
   mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "breast cancer in situ",
                                   "breast cancer"
                          )  
        ) |>
     mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "breast cancer in situ",
                                   "invasive lobular cancer"
                          )  
        )
  
```

### Cervical cancer

```{r}
url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_4362/descendants"

cervical_cancer_terms <- get_descendants(url)

cervical_cancer_terms = stringr::str_replace_all(cervical_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

cervical_cancer_terms = c("cervical intraepithelial neoplasia grade 2/3",
                          "uterine cervical cancer in situ",
                          cervical_cancer_terms)


```

```{r}

gwas_study_info = gwas_study_info |>
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = paste0(cervical_cancer_terms, collapse = "|"),
                                   "cervical cancer"
                          )  
        )

gwas_study_info = gwas_study_info |>
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "uterine cervical cancer in situ",
                                   "cervical cancer"
                          )  
        )

```

### Colorectal cancer

```{r group_colorectal_cancer}


url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0005575/descendants"

colorectal_cancer_terms <- get_descendants(url)

colorectal_cancer_terms = stringr::str_replace_all(colorectal_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

colorectal_cancer_terms= c("metastatic colorectal cancer",
                             "rectum cancer",
                          colorectal_cancer_terms)

```

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = paste0(colorectal_cancer_terms, collapse = "|"),
                                   "colorectal cancer"
                          )  
        ) |>
   mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "colorectal mucinous adenocarcinoma",
                                   "colorectal cancer"
                          )  
        ) |>
   mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "metachronous colorectal adenoma",
                                   "colorectal cancer"
                          )  
        )





```

### Endometrial cancer

```{r group_endometrial_cancer}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0011962/descendants"

endometrial_cancer_terms <- get_descendants(url)

# also: http://www.ebi.ac.uk/efo/EFO_1001514: endometrial endometrioid carcinoma
endometrial_cancer_terms = c("endometrial endometrioid carcinoma",
                             endometrial_cancer_terms)

endometrial_cancer_terms = stringr::str_replace_all(endometrial_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")



```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(endometrial_cancer_terms, collapse = "|"),
                                   "endometrial cancer"
                          )  
        )

```


### Esophageal cancer

```{r group_esophageal_cancer}

esophageal_cancer_terms <- c("esophageal adenocarcinoma",
                             "esophageal squamous cell cancer")


gwas_study_info = gwas_study_info |>
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(esophageal_cancer_terms, collapse = "|"),
                                   "esophageal cancer"
                          )  
        )

```

### Eye cancer (to add)

### Gallbladder and bilary tract cancer

```{r group_gallbladder_biliary_cancer}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                         "cancer of gallbladder and extrahepatic biliary tract",
                         "gallbladder and billary tract cancer"
         )
         )

```

### Hodgkin lymphoma

```{r group_hodgkin_lymphoma}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "nodular sclerosis hodgkin lymphoma",
                          "hodgkins lymphoma"
         ))

```

### Head and neck cancer 

```{r group_head_neck_cancer}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms ,
                          "head and neck squamous cell cancer",
                          "head and neck cancer, squamous cell cancer"
         ))

```

### Kidney cancer

```{r group_kidney_cancer}


url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_263/descendants"


kidney_cancer_terms <- get_descendants(url)

kidney_cancer_terms = c("renal cell carcinoma",
                       "clear cell renal carcinoma",
                       "clear cell renal cell carcinoma",
                       kidney_cancer_terms)

kidney_cancer_terms = stringr::str_replace_all(kidney_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

kidney_cancer_terms =  stringr::str_replace_all(kidney_cancer_terms,
                          "renal cancer",
                          "kidney cancer")



```

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(kidney_cancer_terms, collapse = "|"),
                                   "kidney cancer"
                          )  
        )


```

### Laryngeal cancer

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "laryngeal squamous cell cancer",
                                   "larynx cacner"
                          )  
        )


```

### Leukemia 

```{r group_leukemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000565/descendants"

leukemia_terms <- get_descendants(url)

leukemia_terms = stringr::str_replace_all(leukemia_terms,
                            "\\bcarcinoma",
                            "cancer")


```

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(leukemia_terms, collapse = "|"),
                                   "leukemia"
                          )  
        )


```

### Lip and oral cavity cancer

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0005570/descendants"

lip_oral_cavity_cancer_terms <- get_descendants(url)

lip_oral_cavity_cancer_terms = stringr::str_replace_all(lip_oral_cavity_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(lip_oral_cavity_cancer_terms, collapse = "|"),
                                   "lip and oral cavity cancer"
                          )  
        )

```

### Liver cancer 

```{r group_liver_cancer}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0002691/descendants"

liver_cancer_terms <- get_descendants(url)

liver_cancer_terms = stringr::str_replace_all(liver_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")


liver_cancer_terms = c("hepatitis virus-related liver cancer",
                       liver_cancer_terms)

```

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(liver_cancer_terms, collapse = "|"),
                                   "liver cancer"
                          )  
        )

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "hepatitis virus-related liver cancer",
                                   "liver cancer"
                          )  
        )

```

### Lung cancer 


```{r group_lung_cancer}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0008903/descendants"

lung_cancer_terms <- get_descendants(url)

lung_cancer_terms = stringr::str_replace_all(lung_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

```

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(lung_cancer_terms, collapse = "|"),
                                   "lung cancer"
                          )  
        )


```

### Ovarian cancer

```{r group_ovarian_cancer}

url <-  "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0008170/descendants"

ovarian_cancer_terms <- get_descendants(url)

ovarian_cancer_terms = stringr::str_replace_all(ovarian_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

ovarian_cancer_terms = c("high grade serous ovarian cancer",
                         "high grade ovarian cancer",
                         "high grade ovarian cancers",
                         "ovarian endometrioid cancer", # http://www.ebi.ac.uk/efo/EFO_1001515 - ovarian edometrioid carcinoma
                         
                         "ovarian serous cancer", # http://www.ebi.ac.uk/efo/EFO_1001516 - ovarian serous carcinoma
                       ovarian_cancer_terms
                       )

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = paste0(ovarian_cancer_terms, collapse = "|"),
                                   "ovarian cancer"
                  
        )
 )
        
gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "high grade ovarian cancer",
                                   "ovarian cancer"
                          )  
        )

```

### Prostate cancer

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_10283/descendants"

prostate_cancer_terms <- get_descendants(url)

prostate_cancer_terms = stringr::str_replace_all(prostate_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

prostate_cancer_terms = c("grade iii prostatic intraepithelial neoplasia",
                          "metastatic prostate cancer",
                          prostate_cancer_terms)

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = paste0(prostate_cancer_terms, collapse = "|"),
                                   "prostate cancer"
                          )  
        )

```


### Non-Hodgkins lymphoma

```{r group_nhl}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0005952/descendants"

nhl_terms <- get_descendants(url)

nhl_terms = stringr::str_replace_all(leukemia_terms,
                            "\\bcarcinoma",
                            "cancer")

nhl_terms = c("central nervous system non-hodgkin lymphoma",
              "lymphoblastic lymphoma",
              "extranodal nasal nk/t cell lymphoma", # https://www.ebi.ac.uk/ols4/ontologies/ordo/classes/http%253A%252F%252Fwww.orpha.net%252FORDO%252FOrphanet_86879
              "follicular lymphoma", # http://purl.obolibrary.org/obo/DOID_0050873
              "marginal zone b-cell lymphoma",
              "diffuse large b-cell lymphoma",
              nhl_terms)

```

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(nhl_terms, collapse = "|"),
                                   "non-hodgkins lymphoma"
                          )  
        )


```

### Non-melanoma skin cancer

```{r group_non_melanoma_skin_cancer}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0009260/descendants"

non_melanoma_skin_cancer_terms <- get_descendants(url)

non_melanoma_skin_cancer_terms = stringr::str_replace_all(non_melanoma_skin_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(non_melanoma_skin_cancer_terms, collapse = "|"),
                                   "non-melanoma skin cancer"
                          )  
        )


```

### Other pharygnx cancer

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_0060119/descendants"

other_pharynx_cancer_terms <- get_descendants(url)

other_pharynx_cancer_terms = stringr::str_replace_all(other_pharynx_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

other_pharynx_cancer_terms = c("hypopharyngeal cancer",
                               other_pharynx_cancer_terms)


```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(other_pharynx_cancer_terms, collapse = "|"),
                                   "other pharynx cancer"
                          )  
        )


```

### Stomach cancer

```{r group_stomach_cancer}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_10534/descendants"

stomach_cancer_terms <- get_descendants(url)

stomach_cancer_terms = stringr::str_replace_all(stomach_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

stomach_cancer_terms = c(
                          "diffuse stomach cancer",
                          "gastric cancer",
                          stomach_cancer_terms
                          )

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(stomach_cancer_terms, collapse = "|"),
                                   "stomach cancer"
                          )  
        ) |>
   mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "diffuse stomach cancer",
                                   "stomach cancer"
                          )  
        )

```

### Squamous cell carcinoma 

```{r group_squamous_cell_carcinoma}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = "cutaneous squamous cell cancer",
                                   "squamous cell cancer"
                          )  
        )

```

### Testicular cancer

### Thyroid cancer

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_1781/descendants"

thyroid_cancer_terms <- get_descendants(url)

thyroid_cancer_terms = stringr::str_replace_all(thyroid_cancer_terms,
                            "\\bcarcinoma",
                            "cancer")

thyroid_cancer_terms = c("differentiated thyroid cancer",
                         thyroid_cancer_terms)

```

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(thyroid_cancer_terms, collapse = "|"),
                                   "thyroid cancer"
                          )  
        )

```

### Uterine cancer

```{r}

uterine_cancer_terms <- c("uterine corpus cancer",
                          "uterine adnexa cancer")

gwas_study_info = gwas_study_info |>
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(uterine_cancer_terms, collapse = "|"),
                                   "uterine cancer"
                          )  
        )

```




# Disease onset grouping

### Alzheimer's disease

```{r alz_onset_group}

gwas_study_info = 
gwas_study_info |> 
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "early-onset alzheimers disease|late-onset alzheimers disease",
                          "alzheimers disease"
         )) 
  
  
```

## Asthma

```{r asthma_onset_group}


gwas_study_info = gwas_study_info |> 
    mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms ,
                            "adult onset asthma|childhood onset asthma",
                            "asthma"
           ))



```




## Juvenile idiopathic arthritis

```{r juvenile_idiopathic_arthritis_onset_group}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms ,
                         "systemic juvenile idiopathic arthritis|oligoarticular juvenile idiopathic arthritis|
                         polyarticular juvenile idiopathic arthritis",
                         "juvenile idiopathic arthritis")
        )

```




## Epilepsy 

```{r, eval = F}

# juvenile absence epilepsy
# 
# juvenile myoclonic epilepsy
```



## Myasthenia gravis

```{r myasthenia_gravis_onset_group}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms ,
                         "late-onset myasthenia gravis|early-onset myasthenia gravis",
                         "myasthenia gravis")
        )


```

##  Parkinsons disease (PD)

```{r parkinsons_disease_onset_group}

pd_terms <- c("secondary parkinson disease",
               "young adult-onset parkinsonism",
              "parkinsons disease")

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = paste0(pd_terms, collapse = "|"),
                                   "parkinsons disease"
                          )  
        )

```


# Disease stage grouping

## Chronic kidney disease (CKD)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "chronic kidney disease stage 5|chronic kidney disease stage 4",
                          "chronic kidney disease"
         ))
```


# Final summary - number of unique study terns

```{r final_summary}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(l1_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(l1_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))


head(n_studies_trait)

dim(n_studies_trait)

```

### When separate studies with multiple terms

```{r final_diseases}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l1_all_disease_terms)  |> 
            unlist() |>
            stringr::str_trim()



length(unique(diseases))

# make frequency table
freq <- table(as.factor(diseases))

# sort in decreasing order
freq_sorted <- sort(freq, decreasing = TRUE)

# show top N, e.g. top 10
head(freq_sorted, 10)

```

### Save the updated gwas_study_info with harmonized disease terms

```{r}

gwas_study_info <- fwrite(gwas_study_info,
                          here::here("output/gwas_study_info_trait_ontology_info_l1.csv"))

```



