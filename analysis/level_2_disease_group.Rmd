---
title: "More disease grouping to match GBD"
author: "Isobel Beasley"
date: "2025-09-08"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(ggplot2)
library(stringr)

```

## Ontology help - for getting disease subtypes

```{r ontology_fns}

source(here::here("code/get_term_descendants.R"))

```

```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_cat/gwas_study_info_group_l1_v2.csv"))

```


# Objectives: 

- Further group disease terms (level 2 categories) to match GBD (globalqburden of disease) categories more closely.

## Grouping - level 2 set up 

```{r group_l2}

gwas_study_info = gwas_study_info |>
  mutate(l2_all_disease_terms = l1_all_disease_terms)

```

# Neoplasms 

## [x] Lip and oral cavity cancer

```{r}

gwas_study_info |> 
 filter(grepl("lip and oral cavity cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Nasopharynx cancer

```{r nasopharynx_cancer}}

gwas_study_info =
gwas_study_info |> 
  mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "nasopharyngeal cancer",
                                   "nasopharynx cancer"
                          )  
        )
  
gwas_study_info |> 
 filter(grepl("nasopharynx cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## [x] Other pharynx cancer

```{r other_pharynx_cancer}

gwas_study_info |> 
 filter(grepl("other pharynx cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()
  
```

## Esophageal cancer

```{r esophageal_cancer}

gwas_study_info |>
 filter(grepl("esophageal cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Stomach cancer

```{r stomach_cancer}

gwas_study_info |>
 filter(grepl("stomach cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Colon and rectum cancer

```{r colon_rectum_cancer}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "colorectal cancer",
                                   "colon and rectum cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("colon and rectum cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Liver cancer

```{r liver_cancer}

gwas_study_info |>
 filter(grepl("liver cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Gallbladder and biliary tract cancer

```{r gallbladder_biliary_cancer}

gwas_study_info |>
 filter(grepl("gallbladder and biliary tract cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Pancreatic cancer

```{r pancreatic_cancer}

gwas_study_info |>
 filter(grepl("pancreatic cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Larynx cancer

```{r larynx_cancer}

gwas_study_info |>
 filter(grepl("larynx cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Tracheal, bronchus, and lung cancer

```{r group_respiratory_cancer}

resp_cancer_terms = c("lung cancer",
                      "bronchus cancer",
                      "tracheal cancer",
                      "respiratory system cancer"
                        )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(resp_cancer_terms, collapse = "(?=,|$)|\\b"),
                                   "tracheal bronchus and lung cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("tracheal bronchus and lung cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Malignant skin melanoma

```{r skin_melanoma}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "malignant melanoma of skin",
                                   "malignant skin melanoma"
                          )  
        )

gwas_study_info |>
 filter(grepl("malignant skin melanoma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Non-melanoma skin cancer

```{r non_melanoma_skin_cancer}

gwas_study_info |>
 filter(grepl("non-melanoma skin cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Soft tissue and other extraosseous sarcomas

```{r soft_tissue_sarcomas}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "soft tissue sarcoma",
                                   "soft tissue and other extraosseous sarcomas"
                          )  
        )

gwas_study_info |>
 filter(grepl("soft tissue and other extraosseous sarcomas", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Malignant neoplasm of bone and articular cartilage

```{r bone_cancer}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "bone cancer|osteosarcoma",
                                   "malignant neoplasm of bone and articular cartilage"
                          )  
        )

gwas_study_info |>
 filter(grepl("malignant neoplasm of bone and articular cartilage", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Breast cancer

```{r breast_cancer}

gwas_study_info |>
 filter(grepl("breast cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Cervical cancer

```{r cervical_cancer}

gwas_study_info |>
 filter(grepl("cervical cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Uterine cancer

```{r uterine_cancer}

# ? is endometrial cancer a subset of uterine cancer for GBD?
# is for ontology: http://purl.obolibrary.org/obo/MONDO_0002715
gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "endometrial cancer",
                                   "uterine cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("uterine cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Ovarian cancer

```{r ovarian_cancer}

gwas_study_info |>
 filter(grepl("ovarian cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Prostate cancer

```{r prostate_cancer}

gwas_study_info |>
 filter(grepl("prostate cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Testicular cancer

```{r testicular_cancer}

gwas_study_info |>
 filter(grepl("testicular cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Kidney cancer

```{r kidney_cancer}

gwas_study_info |>
 filter(grepl("kidney cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Bladder cancer

```{r bladder_cancer}

gwas_study_info = 
  gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "urinary bladder cancer",
                                   "bladder cancer"
                          )  
        )


gwas_study_info |>
 filter(grepl("bladder cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Brain and central nervous system cancer

```{r brain_cns_cancer}

gwas_study_info = 
  gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bcentral nervous system cancer\\b",
                                   "brain and central nervous system cancer"
                          )  
        )


gwas_study_info |>
 filter(grepl("brain and central nervous system cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()


```

## Eye cancer


```{r eye_cancer}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bocular melanoma\\b|ocular cancer\\b",
                                   "eye cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("eye cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Neuroblastoma and other peripheral nervous system cancers

```{r neuroblastoma}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bneuroblastoma\\b|\\bperipheral nervous system cancer\\b",
                                   "neuroblastoma and other peripheral nervous system cancers"
                          )  
        )

gwas_study_info |>
 filter(grepl("neuroblastoma and other peripheral nervous system cancers", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Thyroid cancer

```{r thyroid_cancer}

gwas_study_info |>
 filter(grepl("thyroid cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Mesothelioma

```{r mesothelioma}

gwas_study_info |>
 filter(grepl("mesothelioma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Hodgkins lymphoma 

```{r hodgkins_lymphoma}


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "hodgkins lymphoma",
                                   "hodgkin lymphoma"
                          )  
        )


gwas_study_info |> 
 filter(grepl("hodgkin lymphoma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Non-hodgkin lymphoma 

```{r non_hodgkin_lymphoma}


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "non-hodgkins lymphoma",
                                   "non-hodgkin lymphoma"
                          )  
        )

gwas_study_info |>
 filter(grepl("non-hodgkin lymphoma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Multiple myeloma

```{r multiple_myeloma}

gwas_study_info |>
 filter(grepl("multiple myeloma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Leukemia

```{r leukemia}

gwas_study_info |>
 filter(grepl("leukemia", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Other malignant neoplasms

```{r other_malignant_neoplasms}

gwas_study_info =
  gwas_study_info |>
  mutate(l2_all_disease_terms = 
         case_when(
         l2_all_disease_terms == "cancer" ~ "other malignant neoplasms",
         TRUE ~ l2_all_disease_terms
                 )
         )

other_malignant_terms <- c("digestive system cancer",
                           "retroperitoneal cancer",
                           "peritoneal cancer",
                           "ewing sarcoma",
                           "digestive system cancer",
                           "female reproductive organ cancer",
                           "intestinal cancer",
                           "squamous cell cancer",
                           "vulvar cancer",
                           "head and neck cancer",
                           "testicular germ cell tumor",
                           "malignant tumor of floor of mouth", 
                           "malignant lymphoid tumor",
                           "neuroendocrine tumor",
                           "nasal cavity cancer" #? not sure if should be somewhere else .. 
                           )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_malignant_terms, collapse = "(?=,|$)|\\b"),
                                  "other malignant neoplasms"
                          )  
        )


gwas_study_info |>
 filter(grepl("other malignant neoplasms", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Other neoplasms

```{r other_neoplasms}

gwas_study_info =
  gwas_study_info |>
  mutate(l2_all_disease_terms = 
         case_when(
         l2_all_disease_terms == "benign neoplasm" ~ "other neoplasms",
         TRUE ~ l2_all_disease_terms
                 )
         )

gwas_study_info |>
 filter(grepl("other neoplasms", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

# Cardiovascular diseases

## Rheumatic heart disease

```{r rheumatic_heart_disease}

gwas_study_info |>
 filter(grepl("rheumatic heart disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Ischemic heart disease

# Rename disease terms to match GBD categories more closely

## Acne -> acne vulgaris

```{r acne}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "acne",
                                   "acne vulgaris"
                          )  
        )

```

## ADHD

```{r adhd}


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "adhd",
                                   "attention-deficit/hyperactivity disorder"
                          )  
        )


```

## Age-related and other hearing loss 

```{r hearing_loss}


hearing_loss_terms <- c("sensorineural hearing loss",
                        "age-related hearing impairment",
                        "noise-induced hearing loss")

pattern = paste0(hearing_loss_terms, collapse = "(?=,|$)|\\b")


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = pattern,
                                   "age-related and other hearing loss"
                          )  
        )



gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "hearing loss",
                                   "age-related and other hearing loss"
                          )  
        )

```

## Alcohol use disorders

```{r alcohol_use_disorder}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "alcohol-related disorders|alcohol and nicotine codependence",
                                   "alcohol use disorders"
                          )  
        )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "alcohol use disorder",
                                   "alcohol use disorders"
                          )  
        )

```


## Alzheimer's disease and other dementias 

```{r dementia}

dementia <- c("alzheimers disease biomarker measurement",
              "alzheimers disease neuropathologic change",
              "aids dementia",
              "dementia",
              "frontotemporal dementia",
              "lewy body dementia",
              "vascular dementia",
              "alzheimers disease"
)

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(dementia, collapse = "(?=,|$)|\\b"),
                                   "alzheimer's disease and other dementias"
                          )  
        )




```


## Anxiety disorders 

```{r anxiety_disordders}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mesh/terms/http%253A%252F%252Fid.nlm.nih.gov%252Fmesh%252FD001008/descendants"

anxiety_terms <- get_descendants(url)

anxiety_terms <- c(anxiety_terms, "obsessive-compulsive symptom measurement")

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(anxiety_terms, collapse = "(?=,|$)|\\b"),
                                   "anxiety disorders"
                          )  
        ) |>
   mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "anxiety disorder|anxiety measurement",
                                   "anxiety disorders"
                          )  
        ) |>
     mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "anxiety",
                                   "anxiety disorders"
                          )  
        )



```

## Atrial fibrillation & flutter

```{r afib_terms}

afib_terms <- c("atrial fibrillation",
                "atrial flutter",
                "post-operative atrial fibrillation")

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(afib_terms, collapse = "(?=,|$)|\\b"),
                                   "atrial fibrillation and flutter"
                          )  
        )


```

## Amphetamine use disorders

```{r amphetamine_use_disorders}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "methamphetamine",
                                   "amphetamine"
                          )  
        )


```

## Aortic aneurysm

```{r aortic_aneurysm_terms}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/cvdo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_3627/descendants"

aortic_aneurysm_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(aortic_aneurysm_terms, collapse = "(?=,|$)|\\b"),
                                   "aortic aneurysm"
                          )  
        )

```

## Autism spectrum disorders

```{r autism}


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "autism",
                                   "autism spectrum disorders"
                          )  
        )


```

## Blindness and vision loss 

```{r blindness}

vision_loss_terms <- c("blindness",
                       "color vision disorder",
                       "vision disorder",
                       "myopia",
                       "refractive error",
                       "hyperopia",
                       "astigmatism",
                       "corneal astigmatism",
                       "presbyopia",
                       "anisometropia",
                       "esotropia",
                       "non-accomodative esotropia",
                       "accommodative esotropia")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(vision_loss_terms, collapse = "(?=,|$)|\\b"),
                                   "blindness and vision loss"
                          )  
        )

```

## Cannabis use disorders
 
```{r cannabis_use}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "cannabis dependence",
                                   "cannabis use disorders"
                          )  
        )

```

## Cirrhosis & other chronic liver diseases

```{r chronic_liver_disease_terms}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F328383001/descendants"

chronic_liver_disease_terms <- get_descendants(url)

chronic_liver_disease_terms <- c("primary biliary cirrhosis",
                                 "alcoholic liver cirrhosis",
                                 "chronic hepatitis B virus infection", 
                                 "acute-on-chronic liver failure",
                                 chronic_liver_disease_terms)

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(chronic_liver_disease_terms, collapse = "(?=,|$)|\\b"),
                                   "cirrhosis and other chronic liver diseases"
                          )  
        )

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "liver disease",
                                   "cirrhosis and other chronic liver diseases"
                          )  
        )

```


## Cocaine use disorders

```{r cocaine_use_terms}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "cocaine-related disorders",
                                   "cocaine use disorders"
                          )  
        )

```


## Depressive disorders

```{r depressive_disorders}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "depressive symptom measurement|major depressive disorder",
                                   "depressive disorders"
                          )  
        ) |>
   mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "depressive disorder",
                                   "depressive disorders"
                          )  
        )

```

## Gallbladder and biliary diseases

```{r}

gal_bile_terms = c("gallbladder disease",
                   "bile duct disorder",
                   "biliary tract disease")


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(gal_bile_terms, collapse = "(?=,|$)|\\b"),
                                   "gallbladder and biliary diseases"
                          )  
        )



```

## Gynecological diseases

```{r}


diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l2_all_disease_terms)  |> 
            unlist() |>
            stringr::str_trim()


pregnancy_terms <- grep("pregnancy", diseases, value = T)

gyno_terms <- c("endometriosis","placenta disease", pregnancy_terms)


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(gyno_terms, collapse = "(?=,|$)|\\b"),
                                   "gynecological diseases"
                          )  
        )


```

## Eating disorders 

```{r}


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "bulimia nervosa|anorexia nervosa|binge eating|eating disorder",
                                  "eating disorders"
                          )  
        ) |>
   mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "anorexia",
                                  "eating disorders"
                          )  
        )

```

## Headache disorders

```{r headache}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "headache disorder|cluster headache|migraine",
                                   "headache disorders"
                          )  
        )


```

## Ischemic heart disease

== coronary artery disease (https://www.ncbi.nlm.nih.gov/books/NBK209964/)

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "coronary artery disease",
                                   "ischemic heart disease"
                          )  
        )


```

## Opioid use disorders

```{r opioid_use_terms}


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "opioid dependence|opioid use disorder",
                                   "opioid use disorders"
                          )  
        )


```

## Parkinsons disease

```{r pd}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "parkinsons disease",
                                   "parkinson's disease"
                          )  
        )


```

## Personality disorders

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0002028/descendants"

personality_disorders <- get_descendants(url)

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(personality_disorders, collapse = "(?=,|$)|\\b"),
                                   "personality disorders"
                          )  
        )


```

## Other drug use disorders

```{r}


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "heroin dependence|drug dependence|nictone dependence|substance abuse|drug misuse|alcohol use disorders delirium",
                                   "other drug use disorders"
                          )  
        )


```

## Sleep disorders

```{r sleep disorders}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_535/descendants"

sleep_disorders <- get_descendants(url)

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0008568/descendants"

other_sleep_disorders <- get_descendants(url)

sleep_disorders <- c(sleep_disorders,
                    other_sleep_disorders)

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(sleep_disorders, collapse = "(?=,|$)|\\b"),
                                   "sleep disorders"
                          )  
        )


```

# Other neurodegenerative disorder (to do)

take url: "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F52522001/descendants"

# Malignant skin melanoma

and remove alz, parks, dementia 

# Other mental disorders

```{r}

other_mental_disorders <- c("schizophrenia",
                            "manic or hypomanic episode",
                            "mental or behavioural disorder",
                            "mental disorder"
)

```

# Other neurological disorders

```{r}

other_neuro <- c("mild neurocognitive disorder",
                 "hiv-associated neurocognitive disorder")

```

# Other sensory 

disturbances of sensation of smell and taste

# Check compatibility with gbd data 

## Weird fix 

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "disorderss",
                                   "disorders"
                          )  
        )


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "anxiety disorders disorderss",
                                   "anxiety disorders"
                          )  
        )

```

```{r}

gbd_data <- data.table::fread(here::here("data/gbd/ihme_gbd_2019_global_disease_burden_rate_all_ages.csv"))

gbd_data$cause <- stringr::str_remove_all(gbd_data$cause, ",")

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l2_all_disease_terms[gwas_study_info$l2_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

gbd_data$cause[!tolower(gbd_data$cause) %in% unique(diseases)] |> sort()

```

```{r}

gbd_data =
  gbd_data |>
  mutate(cause = tolower(cause))

gwas_disease_traits = data.frame(cause = diseases)
  # gwas_study_info |>
  # filter(DISEASE_STUDY == T) |>
  # select(all_disease_terms, l1_all_disease_terms, cause = l2_all_disease_terms) |>
  # distinct()

left_join(gwas_disease_traits, 
          gbd_data) |>
  head()

gwas_study_info |> select(cause = l2_all_disease_terms) |>
  distinct() |>
  left_join(gbd_data) |>
  head()

```

```{r}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l2_all_disease_terms[gwas_study_info$l2_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

# make frequency table
freq <- table(as.factor(diseases))

# sort in decreasing order
freq_sorted <- sort(freq, decreasing = TRUE)

# show top N, e.g. top 10
head(freq_sorted, 10)

```

### Save the updated gwas_study_info with harmonized disease terms

```{r}

gwas_study_info <- fwrite(gwas_study_info,
                          here::here("output/gwas_cat/gwas_study_info_trait_group_l2.csv"))

```

