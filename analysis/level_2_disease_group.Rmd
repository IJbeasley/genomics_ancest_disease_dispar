---
title: "More disease grouping to match GBD"
author: "Isobel Beasley"
date: "2025-09-08"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(ggplot2)
library(stringr)

```

## Ontology help - for getting disease subtypes

```{r ontology_fns}

source(here::here("code/get_term_descendants.R"))

```

```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_cat/gwas_study_info_group_l1_v2.csv"))

```


# Objectives: 

- Further group disease terms (level 2 categories) to match GBD (globalqburden of disease) categories more closely.

## Grouping - level 2 set up 

```{r group_l2}

gwas_study_info = gwas_study_info |>
  mutate(l2_all_disease_terms = l1_all_disease_terms)

```

# Neoplasms 

## Lip and oral cavity cancer

```{r}

gwas_study_info |> 
 filter(grepl("lip and oral cavity cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Nasopharynx cancer

```{r nasopharynx_cancer}}

gwas_study_info =
gwas_study_info |> 
  mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "nasopharyngeal cancer",
                                   "nasopharynx cancer"
                          )  
        )
  
gwas_study_info |> 
 filter(grepl("nasopharynx cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Other pharynx cancer

```{r other_pharynx_cancer}

gwas_study_info |> 
 filter(grepl("other pharynx cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()
  
```

## Esophageal cancer

```{r esophageal_cancer}

gwas_study_info |>
 filter(grepl("esophageal cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Stomach cancer

```{r stomach_cancer}

gwas_study_info |>
 filter(grepl("stomach cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Colon and rectum cancer

```{r colon_rectum_cancer}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "colorectal cancer",
                                   "colon and rectum cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("colon and rectum cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |> 
  head()

```

## Liver cancer

```{r liver_cancer}

gwas_study_info |>
 filter(grepl("liver cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Gallbladder and biliary tract cancer

```{r gallbladder_biliary_cancer}

gwas_study_info = 
gwas_study_info |>
 mutate(l2_all_disease_terms  = 
        case_when(
          l2_all_disease_terms == "cancer of gallbladder and extrahepatic biliary tract" ~ "gallbladder and biliary tract cancer",
          TRUE ~ l2_all_disease_terms
                 )
        )

gwas_study_info |>
 filter(grepl("gallbladder and biliary tract cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Pancreatic cancer

```{r pancreatic_cancer}

gwas_study_info |>
 filter(grepl("pancreatic cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Larynx cancer

```{r larynx_cancer}

gwas_study_info |>
 filter(grepl("larynx cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Tracheal, bronchus, and lung cancer

```{r group_respiratory_cancer}

resp_cancer_terms = c("lung cancer",
                      "bronchus cancer",
                      "tracheal cancer",
                      "respiratory system cancer"
                        )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  =
          ifelse(l2_all_disease_terms != "tracheal bronchus and lung cancer",
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(resp_cancer_terms, collapse = "(?=,|$)|\\b"),
                                   "tracheal bronchus and lung cancer"
                          ),
          l2_all_disease_terms
          )
        )

gwas_study_info |>
 filter(grepl("tracheal bronchus and lung cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Malignant skin melanoma

```{r skin_melanoma}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "malignant melanoma of skin",
                                   "malignant skin melanoma"
                          )  
        )

gwas_study_info |>
 filter(grepl("malignant skin melanoma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Non-melanoma skin cancer

```{r non_melanoma_skin_cancer}

gwas_study_info |>
 filter(grepl("non-melanoma skin cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Soft tissue and other extraosseous sarcomas

```{r soft_tissue_sarcomas}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "soft tissue sarcoma",
                                   "soft tissue and other extraosseous sarcomas"
                          )  
        )

gwas_study_info |>
 filter(grepl("soft tissue and other extraosseous sarcomas", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Malignant neoplasm of bone and articular cartilage

```{r bone_cancer}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "bone cancer|osteosarcoma",
                                   "malignant neoplasm of bone and articular cartilage"
                          )  
        )

gwas_study_info |>
 filter(grepl("malignant neoplasm of bone and articular cartilage", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Breast cancer

```{r breast_cancer}

gwas_study_info |>
 filter(grepl("breast cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Cervical cancer

```{r cervical_cancer}

gwas_study_info |>
 filter(grepl("cervical cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Uterine cancer

```{r uterine_cancer}

# ? is endometrial cancer a subset of uterine cancer for GBD?
# is for ontology: http://purl.obolibrary.org/obo/MONDO_0002715
gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "endometrial cancer",
                                   "uterine cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("uterine cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Ovarian cancer

```{r ovarian_cancer}

gwas_study_info |>
 filter(grepl("ovarian cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Prostate cancer

```{r prostate_cancer}

gwas_study_info |>
 filter(grepl("prostate cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Testicular cancer

```{r testicular_cancer}

gwas_study_info |>
 filter(grepl("testicular cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct()

```

## Kidney cancer

```{r kidney_cancer}

gwas_study_info |>
 filter(grepl("kidney cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head() 

```

## Bladder cancer

```{r bladder_cancer}

gwas_study_info = 
  gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "urinary bladder cancer",
                                   "bladder cancer"
                          )  
        )


gwas_study_info |>
 filter(grepl("bladder cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() 

```

## Brain and central nervous system cancer

```{r brain_cns_cancer}

gwas_study_info = 
  gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bcentral nervous system cancer\\b",
                                   "brain and central nervous system cancer"
                          )  
        )


gwas_study_info |>
 filter(grepl("brain and central nervous system cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Eye cancer


```{r eye_cancer}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bocular melanoma\\b|ocular cancer\\b",
                                   "eye cancer"
                          )  
        )

gwas_study_info |>
 filter(grepl("eye cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |> 
  head()

```

## Neuroblastoma and other peripheral nervous cell tumors

```{r neuroblastoma}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bneuroblastoma\\b|\\bperipheral nervous system cancer\\b",
                                   "neuroblastoma and other peripheral nervous cell tumors"
                          )  
        )

gwas_study_info |>
 filter(grepl("neuroblastoma and other peripheral nervous cell tumors", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Thyroid cancer

```{r thyroid_cancer}

gwas_study_info |>
 filter(grepl("thyroid cancer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Mesothelioma

```{r mesothelioma}

gwas_study_info |>
 filter(grepl("mesothelioma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Hodgkins lymphoma 

```{r hodgkins_lymphoma}


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "hodgkins lymphoma",
                                   "hodgkin lymphoma"
                          )  
        )


gwas_study_info |> 
 filter(grepl("hodgkin lymphoma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Non-hodgkin lymphoma 

```{r non_hodgkin_lymphoma}


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "non-hodgkins lymphoma",
                                   "non-hodgkin lymphoma"
                          )  
        )

gwas_study_info |>
 filter(grepl("non-hodgkin lymphoma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Multiple myeloma

```{r multiple_myeloma}

gwas_study_info |>
 filter(grepl("multiple myeloma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Leukemia

```{r leukemia}

gwas_study_info |>
 filter(grepl("leukemia", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other malignant neoplasms

```{r other_malignant_neoplasms}

gwas_study_info =
  gwas_study_info |>
  mutate(l2_all_disease_terms = 
         case_when(
         l2_all_disease_terms == "cancer" ~ "other malignant neoplasms",
         TRUE ~ l2_all_disease_terms
                 )
         )

gwas_study_info =
  gwas_study_info |>
  mutate(l2_all_disease_terms = 
         ifelse(PUBMED_ID == 27790247,
                stringr::str_replace_all(l2_all_disease_terms,
                                        pattern = ", cancer,",
                                        ", other malignant neoplasms,"
                                        ),
                l2_all_disease_terms
                
         )
  )


### dealing with measuring cancer caused factor terms
gwas_study_info |> 
  filter(grepl("^cancer,", l2_all_disease_terms)) |> 
  pull(l2_all_disease_terms) |> 
  unique()
 

gwas_study_info =
  gwas_study_info |>
  mutate(l2_all_disease_terms = 
         ifelse(grepl("^cancer,", l2_all_disease_terms),
                stringr::str_replace_all(l2_all_disease_terms,
                                        pattern = "^cancer,",
                                        "other malignant neoplasms,"
                                        ),
                l2_all_disease_terms
                
         )
  )

other_malignant_terms <- c(
                           "retroperitoneal cancer",
                           "peritoneal cancer",
                           "ewing sarcoma",
                           
                           "digestive system cancer",
                           "intestinal cancer",
                           "small intestine cancer",
                           
                           "female reproductive organ cancer",
                           "male reproductive organ cancer",
                           "vulvar cancer",                           
                           "testicular germ cell tumor",
                           "urogenital cancer",
                           
                           "squamous cell cancer",

                           "head and neck cancer",
                           "malignant tumor of floor of mouth", 
                           "nasal cavity cancer", #? not sure if should be somewhere else .. 
                           
                           "malignant lymphoid tumor",
                           "neuroendocrine tumor",
                           "lymphatic system cancer",
                           
                           "childhood cancer" #? maybe sort furtrher

                           )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_malignant_terms, collapse = "(?=,|$)|\\b"),
                                  "other malignant neoplasms"
                          )  
        )


gwas_study_info |>
 filter(grepl("other malignant neoplasms", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |> 
  head()

```

## Other neoplasms

```{r other_neoplasms}

gwas_study_info =
  gwas_study_info |>
  mutate(l2_all_disease_terms = 
         case_when(
         l2_all_disease_terms == "benign neoplasm" ~ "other neoplasms",
         TRUE ~ l2_all_disease_terms
                 )
         )

unknown_sig_terms <- c("intracranial germ cell tumor",
                       "bladder tumor")

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(unknown_sig_terms, collapse = "(?=,|$)|\\b"),
                                   "other neoplasms"
                          )
 )

gwas_study_info |>
 filter(grepl("other neoplasms", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

# Cardiovascular diseases

## Rheumatic heart disease

```{r rheumatic_heart_disease}

gwas_study_info |>
 filter(grepl("rheumatic heart disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Ischemic heart disease

```{r ischemic_heart_disease}

gwas_study_info |>
 filter(grepl("ischemic heart disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

== coronary artery disease (https://www.ncbi.nlm.nih.gov/books/NBK209964/)

```{r}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "coronary artery disease",
                                   "ischemic heart disease"
                          )  
        )


```

## Stroke 

```{r stroke_terms}

gwas_study_info |>
 filter(grepl("stroke", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Hypertensive heart disease

```{r hypertensive_heart_disease}

gwas_study_info |>
 filter(grepl("hypertensive heart disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Non-rheumatic valvular heart disease

```{r non_rheumatic_heart_disease}

gwas_study_info |>
 filter(grepl("heart valve disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

gwas_study_info = gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "heart valve disease",
                                   "non-rheumatic valvular heart disease"
                          )  
        )



gwas_study_info |>
 filter(grepl("non-rheumatic valvular heart disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```



## Cardiomyopathy and myocarditis

```{r cardiomyopathy_myocarditis}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "\\bcardiomyopathy\\b|\\bmyocarditis\\b",
                                   "cardiomyopathy and myocarditis"
                          )  
        )

gwas_study_info |>
 filter(grepl("cardiomyopathy and myocarditis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Pulmonary arterial hypertension

```{r pulmonary_arterial_hypertension}

gwas_study_info |>
 filter(grepl("pulmonary arterial hypertension", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Atrial fibrillation & flutter

```{r afib_terms}

afib_terms <- c("atrial fibrillation",
                "atrial flutter",
                "post-operative atrial fibrillation")

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(afib_terms, collapse = "(?=,|$)|\\b"),
                                   "atrial fibrillation and flutter"
                          )  
        )

gwas_study_info |>
 filter(grepl("atrial fibrillation and flutter", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()


```

## Aortic aneurysm

```{r aortic_aneurysm_terms}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/cvdo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_3627/descendants"

aortic_aneurysm_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(aortic_aneurysm_terms, collapse = "(?=,|$)|\\b"),
                                   "aortic aneurysm"
                          )  
        )

gwas_study_info |>
 filter(grepl("aortic aneurysm", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Lower extremity peripheral arterial disease

```{r peripheral_arterial_disease}

gwas_study_info |>
 filter(grepl("lower extremity peripheral arterial disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Endocarditis

```{r endocarditis}

gwas_study_info |> 
 filter(grepl("endocarditis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Other cardiovascular and circulatory diseases

```{r other_cardiovascular_diseases}

other_cardiovascular_terms <- c("tachycardia",
                                "other cardiac arrhythmias",
                                "heart block",
                                "carotid artery disease",
                                "(?=,|^)hypertension",
                                "pericarditis",
                                "coronary artery calcification",
                                "arterial occlusion",
                                "congenital heart disease",
                                "other vascular disorders",
                                "congestive heart failure",
                                "heart failure",
                                "thrombotic diseas",
                                "arterial embolism",
                                "cardiac embolism",
                                "venus embolism",
                                "venus thrombosis",
                                "pulmonary embolism",                                
                                "arterial thrombosis",
                                "thromboembolism",
                                "vascular insufficiency",
                                "brain infarction",
                                "heart murmur"
                                 )

other_cardiovascular_terms <- str_length_sort(other_cardiovascular_terms)
other_cardiovascular_terms <- paste0("(?=, |^)", other_cardiovascular_terms)
other_cardiovascular_terms <- paste0(other_cardiovascular_terms, "(?=,|$)")

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_cardiovascular_terms, collapse = "|"),
                                   "other cardiovascular and circulatory diseases"
                          )
 )

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "(?=, |^)other vascular disorders(?=,|$)",
                                   "other cardiovascular and circulatory diseases"
                          )
 )

gwas_study_info |>
 filter(grepl("other cardiovascular and circulatory diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


# Chronic respiratory diseases

## Chronic obstructive pulmonary disease

```{r copd_terms}

gwas_study_info |>
 filter(grepl("chronic obstructive pulmonary disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Pneumoconiosis

```{r pneumoconiosis_terms}

gwas_study_info |>
 filter(grepl("pneumoconiosis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Asthma

```{r asthma_terms}

gwas_study_info |>
 filter(grepl("asthma", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Interstitial lung disease and pulmonary sarcoidosis

```{r interstitial_lung_disease_terms}

interstitial_lung_disease_terms <- c("pulmonary sarcoidosis",
                                   "interstitial lung disease"
                                   )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(interstitial_lung_disease_terms, 
                                                   collapse = "(?=,|$)|\\b"),
                                   "interstitial lung disease and pulmonary sarcoidosis"
                          )  
        )

gwas_study_info |>
 filter(grepl("interstitial lung disease and pulmonary sarcoidosis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other chronic respiratory diseases

```{r other_chronic_respiratory_diseases}

gwas_study_info |>
 filter(grepl("other chronic respiratory diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

# Digestive diseases

## Cirrhosis & other chronic liver diseases

```{r chronic_liver_disease_terms}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F328383001/descendants"

chronic_liver_disease_terms <- get_descendants(url)

chronic_liver_disease_terms <- c("primary biliary cirrhosis",
                                 "alcoholic liver cirrhosis",
                                 "chronic hepatitis B virus infection", 
                                 "acute-on-chronic liver failure",
                                 "non-alcoholic fatty liver disease",
                                 "cirrhosis of liver",
                                 "primary biliary cirrhosis",
                                 "chronic hepatitis",
                                 "liver disease",
                                 chronic_liver_disease_terms)

chronic_liver_disease_terms <- str_length_sort(chronic_liver_disease_terms)

chronic_liver_disease_terms <- paste0("(?=, |^)", chronic_liver_disease_terms)
chronic_liver_disease_terms <- paste0(chronic_liver_disease_terms, "(?=,|$)")

pattern = paste0(chronic_liver_disease_terms, collapse = "|")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = pattern,
                                   "cirrhosis and other chronic liver diseases"
                          )  
        )

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "(?=, |^)liver disease(?=,|$)",
                                   "cirrhosis and other chronic liver diseases"
                          )  
        )


gwas_study_info |>
 filter(grepl("cirrhosis and other chronic liver diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Upper digestive system diseases

```{r upper_digestive_disease_terms}

upper_dig_terms <- c("peptic ulcer diseases",
                     "duodenitis",
                     "gastritis",
                     "gastroesophageal reflux disease")

gwas_study_info = gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(upper_dig_terms, collapse = "(?=,|$)|\\b"),
                                   "upper digestive system diseases"
                          )  
        )

gwas_study_info |>
 filter(grepl("upper digestive system diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()


```

## Appendicitis

```{r appendicitis_terms}

gwas_study_info |>
 filter(grepl("appendicitis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Paralytic ileus and intestinal obstruction

```{r paralytic_ileus_terms}

gwas_study_info = gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "\\bparalytic ileus\\b|\\bintestinal obstruction\\b",
                                   "paralytic ileus and intestinal obstruction"
                          )  
        )

gwas_study_info |>
 filter(grepl("paralytic ileus and intestinal obstruction", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Inguinal femoral and abdominal hernia

```{r hernia_terms}

hernia_terms <- c("inguinal hernia",
                  "femoral hernia",
                  "abdominal hernia",
                  "hernia of the abdominal wall")

gwas_study_info = gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(hernia_terms, collapse = "(?=,|$)|\\b"),
                                   "inguinal femoral and abdominal hernia"
                          )  
        )

gwas_study_info |>
 filter(grepl("inguinal femoral and abdominal hernia", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Inflammatory bowel disease

```{r ibd_terms}

ibd_terms <- c("crohns disease",
               "ulcerative colitis",
               "inflammatory bowel disease")

gwas_study_info = gwas_study_info |>
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(ibd_terms, collapse = "(?=,|$)|\\b"),
                                   "inflammatory bowel disease"
                          )  
        )

```

## Vascular intestinal disorders

```{r vascular_intestinal_disorders_terms}

gwas_study_info |>
 filter(grepl("vascular intestinal disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Gallbladder and biliary diseases

```{r}

gal_bile_terms = c("gallbladder disease",
                   "bile duct disorder",
                   "biliary tract disease")


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(gal_bile_terms, collapse = "(?=,|$)|\\b"),
                                   "gallbladder and biliary diseases"
                          )  
        )

gwas_study_info |>
 filter(grepl("gallbladder and biliary diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Pancreatitis

```{r pancreatitis_terms}

gwas_study_info |>
 filter(grepl("pancreatitis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other digestive diseases

```{r other_digestive_diseases_terms}

gwas_study_info |>
 filter(grepl("other digestive diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


# Neurological disorders

## Alzheimer's disease and other dementias 

```{r dementia}

dementia <- c("alzheimers disease biomarker measurement",
              "alzheimers disease neuropathologic change",
              "aids dementia",
              "dementia",
              "frontotemporal dementia",
              "lewy body dementia",
              "vascular dementia",
              "alzheimers disease"
)

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(dementia, collapse = "(?=,|$)|\\b"),
                                   "alzheimer's disease and other dementias"
                          )  
        )

gwas_study_info |>
 filter(grepl("alzheimer's disease and other dementias", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Parkinsons disease

```{r pd}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "parkinsons disease",
                                   "parkinson's disease"
                          )  
        )

gwas_study_info |>
 filter(grepl("parkinson's disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Idiopathic epilepsy

```{r epilepsy}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "idiopathic generalized epilepsy",
                                   "idiopathic epilepsy"
                          )  
        )

gwas_study_info |>
 filter(grepl("idiopathic epilepsy", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Multiple sclerosis

```{r ms}

gwas_study_info |>
 filter(grepl("multiple sclerosis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Motor neuron disease

```{r mnd}

gwas_study_info |>
 filter(grepl("motor neuron disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Headache disorders

```{r headache}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "\\bheadache disorder\\b|cluster headache\\b|migraine\\b",
                                   "headache disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("headache disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other neurological disorders

```{r other_neurological_disorders}

gwas_study_info |>
 filter(grepl("other neurological disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


# Mental disorders

## Schizophrenia

```{r schizophrenia}

gwas_study_info |>
 filter(grepl("schizophrenia", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Depressive disorders

```{r depressive_disorders}

depressive_terms <- c("depressive disorder",
                      "depressive symptom",
                      "depressive episode",
                      "major depressive disorders",
                      "major depressive disorder",
                      "major depressive episode"
)

depressive_terms <- str_length_sort(depressive_terms)
depressive_terms <- paste0("(?=, |^)", depressive_terms)
depressive_terms <- paste0(depressive_terms, "(?=,|$)")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(depressive_terms, collapse = "|"),
                                   "depressive disorders"
                          )  
        ) |>
   mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "(?=, |^)depressive disorder(?=,|$)",
                                   "depressive disorders"
                          )  
        ) |>
     mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "(?=, |^)major depressive episode(?=,|$)",
                                   "depressive disorders"
                          )  
        )
  
  


gwas_study_info |>
 filter(grepl("depressive disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Anxiety disorders 

```{r anxiety_disordders}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mesh/terms/http%253A%252F%252Fid.nlm.nih.gov%252Fmesh%252FD001008/descendants"

anxiety_terms <- get_descendants(url)

anxiety_terms <- c(anxiety_terms, 
                   "obsessive-compulsive symptom measurement",
                   "obsessive-compulsive disorder"
                   )

anxiety_terms <- str_length_sort(anxiety_terms)
anxiety_terms <- paste0("(?=, |^)", anxiety_terms)
anxiety_terms <- paste0(anxiety_terms, "(?=,|$)")

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(anxiety_terms, collapse = "|"),
                                   "anxiety disorders"
                          )  
        ) |>
   mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "(?=, |^)anxiety disorder(?=,|$)|(?=, |^)anxiety measurement(?=,|$)",
                                   "anxiety disorders"
                          )  
        ) |>
     mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "(?=, |^)anxiety(?=,|$)",
                                   "anxiety disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("anxiety disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Eating disorders 

```{r}


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "bulimia nervosa|anorexia nervosa|binge eating|eating disorder",
                                  "eating disorders"
                          )  
        ) |>
   mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "anorexia",
                                  "eating disorders"
                          )  
        )


gwas_study_info |>
 filter(grepl("eating disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Autism spectrum disorders

```{r autism}


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = "autism",
                                   "autism spectrum disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("autism spectrum disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## ADHD

```{r adhd}


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "adhd",
                                   "attention-deficit/hyperactivity disorder"
                          )  
        )

gwas_study_info |>
 filter(grepl("attention-deficit/hyperactivity disorder", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Conduct disorder

```{r conduct_disorder}

gwas_study_info |>
 filter(grepl("conduct disorder", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Idiopathic developmental intellectual disability

```{r idiopathic_developmental_intellectual_disability}

terms <- c("developmental disability")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(terms, collapse = "(?=,|$)|\\b"),
                                   "idiopathic developmental intellectual disability"
                          )  
        )

gwas_study_info |>
 filter(grepl("idiopathic developmental intellectual disability", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other mental disorders

### Personality disorders

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0002028/descendants"

personality_disorders <- get_descendants(url)

personality_disorders <- paste0("(?=, |^)", personality_disorders)
personality_disorders <- paste0(personality_disorders, "(?=,|$)")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(personality_disorders, collapse = "|"),
                                   "personality disorders"
                          )  
        )


```


### Mood disorders

```{r mood_disorders}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0004247/descendants"

mood_disorders <- get_descendants(url)

mood_disorders <- str_length_sort(mood_disorders)
mood_disorders <- paste0("(?=, |^)", mood_disorders)
mood_disorders <- paste0(mood_disorders, "(?=,|$)")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(mood_disorders, collapse = "|"),
                                   "mood disorder"
                          )  
        )


```

### Sleep disorders

```{r sleep disorders}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_535/descendants"

sleep_disorders <- get_descendants(url)

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0008568/descendants"

other_sleep_disorders <- get_descendants(url)

sleep_disorders <- c(sleep_disorders,
                    other_sleep_disorders)
sleep_disorders <- str_length_sort(sleep_disorders)

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(sleep_disorders, collapse = "(?=,|$)|\\b"),
                                   "sleep disorders"
                          )  
        )


```

```{r other_mental_disorders}

other_mental_disorders <- c("manic or hypomanic episode",
                            "mental or behavioural disorder",
                            "mental disorder",
                            "post-traumatic stress disorder",
                            "stress-related disorder",
                            "acute stress reaction",
                            "occupation-related stress disorder",
                            "psychotic symptom",
                            "psychosis",
                            "psychiatric disorder",
                             "personality disorders",
                            "personality disorder",
                            "mood disorder",
                            "sleep disorders",
                            "sleep disorder",
                            "mixed anxiety disorders and depressive disorders",
                            "emotional symptom",
                            "dissociative disorder",
                            "hallucinations",
                            "somatoform disorder",
                            "schizoaffective disorder"
                            
)

other_mental_disorders <- str_length_sort(other_mental_disorders)
other_mental_disorders <- paste0("(?=, |^)", other_mental_disorders)
other_mental_disorders <- paste0(other_mental_disorders, "(?=,|$)")

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_mental_disorders, collapse = "|"),
                                   "other mental disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("other mental disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

# Substance use disorders

## Alcohol use disorders

```{r alcohol_use_disorder}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "alcohol-related disorders|alcohol and nicotine codependence",
                                   "alcohol use disorders"
                          )  
        )

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "alcohol use disorder",
                                   "alcohol use disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("alcohol use disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Opioid use disorders

```{r opioid_use_terms}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "opioid dependence|opioid use disorder",
                                   "opioid use disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("opioid use disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Cocaine use disorders

```{r cocaine_use_terms}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "cocaine-related disorders",
                                   "cocaine use disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("cocaine use disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Amphetamine use disorders

```{r amphetamine_use_disorders}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "methamphetamine",
                                   "amphetamine"
                          )  
        )

gwas_study_info |>
 filter(grepl("amphetamine", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Cannabis use disorders
 
```{r cannabis_use}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "cannabis dependence",
                                   "cannabis use disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("cannabis use disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other drug use disorders

```{r}

other_drug_use_terms <- c("heroin dependence",
                          "drug dependence",
                          "nictone dependence",
                          "substance abuse",
                          "drug misuse",
                          "alcohol use disorders delirium"
                          )

other_drug_use_terms <- str_length_sort(other_drug_use_terms)
other_drug_use_terms <- paste0("(?=, |^)", other_drug_use_terms)
other_drug_use_terms <- paste0(other_drug_use_terms, "(?=,|$)")

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_drug_use_terms, collapse = "|"),
                                   "other drug use disorders"
                          )  
        )

gwas_study_info |>
 filter(grepl("other drug use disorders", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()


```

# Diabetes and kidney diseases

## Diabetes mellitus type 1

```{r diabetes_type_1}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "type 1 diabetes mellitus",
                                   "diabetes mellitus type 1"
                          )  
        )

gwas_study_info |>
 filter(grepl("diabetes mellitus type 1", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Diabetes mellitus type 2

```{r diabetes_type_2}

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "type 2 diabetes mellitus",
                                   "diabetes mellitus type 2"
                          )  
        )

gwas_study_info |>
 filter(grepl("diabetes mellitus type 2", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Chronic kidney disease

```{r chronic_kidney_disease}

gwas_study_info |>
 filter(grepl("chronic kidney disease", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Acute glomerulonephritis

```{r acute_glomerulonephritis}

glomerulonephritis_terms <- c("(?=, |^)chronic glomerulonephritis",
                              "(?=, |^)membranous glomerulonephritis",
                              "(?=, |^)proliferative glomerulonephritis")

gwas_study_info |>
  mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(glomerulonephritis_terms, collapse = "(?=,|$)|\\b"),
                                   "glomerulonephritis"
                          )  
        )
  


gwas_study_info |>
 filter(grepl("acute glomerulonephritis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

# Skin and subcutaneous diseases

## Dermatitis 

```{r dermatitis_terms}

gwas_study_info |>
 filter(grepl("dermatitis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Psoriasis

```{r psoriasis_terms}

gwas_study_info |>
 filter(grepl("psoriasis", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Bacterial skin diseases

```{r bacterial_skin_diseases}

bacterial_skin_disease_terms <- c("staphylococcal skin infections",
                                  "skin and soft tissue staphylococcus aureus infection")

bacterial_skin_disease_terms <- str_length_sort(bacterial_skin_disease_terms)
bacterial_skin_disease_terms <- paste0("(?=, |^)", bacterial_skin_disease_terms)
bacterial_skin_disease_terms <- paste0(bacterial_skin_disease_terms, "(?=,|$)")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(bacterial_skin_disease_terms, collapse = "|"),
                                   "bacterial skin diseases"
                          )  
        )

gwas_study_info |>
 filter(grepl("bacterial skin diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Scabies 

```{r scabies_terms}

gwas_study_info |>
 filter(grepl("scabies", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```


## Fungal skin diseases

```{r fungal_skin_diseases}

fungal_skin_disease_terms <- c("tinea",
                               "dermatomycosis")

fungal_skin_disease_terms <- str_length_sort(fungal_skin_disease_terms)
fungal_skin_disease_terms <- paste0("(?=, |^)", fungal_skin_disease_terms)
fungal_skin_disease_terms <- paste0(fungal_skin_disease_terms, "(?=,|$)")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(fungal_skin_disease_terms, collapse = "|"),
                                   "fungal skin diseases"
                          )  
        )

gwas_study_info |>
 filter(grepl("fungal skin diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Viral skin diseases

```{r viral_skin_diseases}

gwas_study_info |>
 filter(grepl("viral skin diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Acne vulgaris

```{r acne}

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "acne",
                                   "acne vulgaris"
                          )  
        )

gwas_study_info |>
 filter(grepl("acne vulgaris", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Pruritus

```{r pruritus_terms}

gwas_study_info |>
 filter(grepl("pruritus", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Urticaria

```{r urticaria_terms}

gwas_study_info |>
 filter(grepl("urticaria", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Decubitus ulcer

```{r decubitus_ulcer_terms}

gwas_study_info |>
 filter(grepl("decubitus ulcer", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other skin and subcutaneous diseases

```{r other_skin_diseases}

other_skin_disease_terms <- c("sebaceous gland disease",
                              "rosacea",
                              "erythematosquamous dermatosis",
                              "dry skin",
                              "skin tags",
                              "dermatochalasis",
                              "epidermal thickening",
                              "epidermal inclusion cyst",
                              "cutaneous lupus erythematosus",
                              "androgenetic alopecia",
                              "chemotherapy-induced alopecia",
                              "cutaneous leishmaniasis")

other_skin_disease_terms <- str_length_sort(other_skin_disease_terms)
other_skin_disease_terms <- paste0("(?=, |^)", other_skin_disease_terms)
other_skin_disease_terms <- paste0(other_skin_disease_terms, "(?=,|$)")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_skin_disease_terms, collapse = "|"),
                                   "other skin and subcutaneous diseases"
                          )
 )
                                   

gwas_study_info |>
 filter(grepl("other skin and subcutaneous diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()


```



# Sense organ diseases

## Blindness and vision loss 

```{r blindness}

vision_loss_terms <- c("blindness",
                       "color vision disorder",
                       "vision disorder",
                       "visuospatial impairment",
                       "pathological blindness and vision loss",
                       "visual impairment",
                       "myopia",
                       "refractive error",
                       "hyperopia",
                       "astigmatism",
                       "corneal astigmatism",
                       "presbyopia",
                       "anisometropia",
                       "esotropia",
                       "non-accomodative esotropia",
                       "accommodative esotropia",
                       "abnormality of refraction",
                       "abnormality of vision",
                       "age-related macular degeneration",
                       "degeneration of macula and posterior pole",
                       "age-related cataract",
                       "cataract")

gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(vision_loss_terms, collapse = "(?=,|$)|\\b"),
                                   "blindness and vision loss"
                          )  
        )

gwas_study_info |>
 filter(grepl("blindness and vision loss", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Age-related and other hearing loss 

```{r hearing_loss}


hearing_loss_terms <- c("sensorineural hearing loss",
                        "sensorineural hearing impairment",
                        "age-related hearing impairment",
                        "conductive hearing impairment",
                        "noise-induced hearing loss",
                        "deafness")

hearing_loss_terms <- str_length_sort(hearing_loss_terms)

hearing_loss_terms <- paste0("(?=, |^)", hearing_loss_terms)
hearing_loss_terms <- paste0(hearing_loss_terms, "(?=,|$)")

pattern = paste0("(?=, |^)", hearing_loss_terms, collapse = "(?=,|$)|\\b")


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = pattern,
                                   "age-related and other hearing loss"
                          )  
        )



gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "(?=, |^)hearing loss(?=,|$)",
                                   "age-related and other hearing loss"
                          )  
        )


gwas_study_info |>
 filter(grepl("age-related and other hearing loss", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```

## Other sense organ diseases

```{r other_sense_organ_diseases}

other_sense_terms <- c("abnormality of the sense of smell",
                       "disturbances of sensation of smell and taste")

other_sense_terms <- str_length_sort(other_sense_terms)
other_sense_terms <- paste0("(?=, |^)", other_sense_terms)
other_sense_terms <- paste0(other_sense_terms, "(?=,|$)")

gwas_study_info =
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = paste0(other_sense_terms, collapse = "|"),
                                   "other sense organ diseases"
                          )  
        )

gwas_study_info |>
 filter(grepl("other sense organ diseases", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()

```














































# Other neurodegenerative disorder (to do)

take url: "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F52522001/descendants"

# Other neurological disorders

```{r}

other_neuro <- c("mild neurocognitive disorder",
                 "hiv-associated neurocognitive disorder")

```


# Other non-communicable diseases

## Urinary diseases and male infertility

```{r urinary_diseases}

urinary_diseases_terms <- c("urinary incontinence",
                            "stress urinary incontinence",
                            "urgency urinary incontinence",
                            "urinary system disease",
                            "urinary tract obstruction",
                            "bladder neck obstruction",
                            "bladder calculus",
                            "urethral disease",
                            "uterine disorder",
                            "urethral syndrome",
                            "uterine inflammatory disease",
                            "lower urinary tract calculus",
                            "enuresis"
                            )

urinary_diseases_terms <- str_length_sort(urinary_diseases_terms)

urin_male_infert <- c(urinary_diseases_terms, "male infertility")

urin_male_infert <- paste0("(?=, |^)", urin_male_infert)
urin_male_infert <- paste0(urin_male_infert, "(?=,|$)")

gwas_study_info = gwas_study_info |>
  mutate(l2_all_disease_terms = 
           stringr::str_replace_all(
             l2_all_disease_terms,
             paste0("(?=, |^)", urin_male_infert, collapse = "|"),
             "urinary diseases and male infertility"
           )
  )
         
```

## Gynocological diseases

```{r gynocological_diseases}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l2_all_disease_terms)  |> 
            unlist() |>
            stringr::str_trim()


pregnancy_terms <- grep("pregnancy", diseases, value = T)

gyno_terms <- c("endometriosis",
                "female reproductive system disease",
                "female genital tract fistula",
                "placenta disease", 
                "female infertility",
                "polycystic ovary syndrome",
                "ovarian dysfunction",
                "ovarian gynecological diseases",
                "ovarian cyst",
                "ovarian disease",
                "primary ovarian insufficiency",
                "premature ovarian insufficiency",
                "vaginal inflammation",
                "vaginal disorder",
                "postmenopausal atrophic vaginitis",
                "uterine prolapse",
                "atrophic vaginitis",
                "vaginitis",
                "vulvovaginitis",
                "abnormal delivery",
                pregnancy_terms)

gyno_terms <- str_length_sort(gyno_terms)
gyno_terms <- paste0("(?=, |^)", gyno_terms)
gyno_terms <- paste0(gyno_terms, "(?=,|$)")


gwas_study_info = gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms,
                                  pattern = paste0(gyno_terms, collapse = "(?=,|$)|\\b"),
                                   "gynecological diseases"
                          )  
        )

```


## Hemoglobinopathies and hemolytic anemias

```{r hemoglobinopathies}


hemoglobinopathies_terms <- c("sickle cell disease and related diseases",
                              "thalassemia",
                              "inherited hemoglobinopathy",
                              "hemoglobin e disease"
)

hemopath_hemo_anemias <- c(hemoglobinopathies_terms, "hemolytic anemia")

gwas_study_info = gwas_study_info |>
  mutate(l2_all_disease_terms = 
           stringr::str_replace_all(
             l2_all_disease_terms,
             paste0("(?=, |^)", hemopath_hemo_anemias, collapse = "|"),
             "hemoglobinopathies and hemolytic anemias"
           )
  )

gwas_study_info |>
 filter(grepl("hemoglobinopathies and hemolytic anemias", l2_all_disease_terms)) |>
  select(all_disease_terms, l2_all_disease_terms) |>
  distinct() |>
  head()


```




# Check compatibility with gbd data 

## Weird fix 

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "disorderss",
                                   "disorders"
                          )  
        )


gwas_study_info = 
gwas_study_info |> 
 mutate(l2_all_disease_terms  = 
          stringr::str_replace_all(l2_all_disease_terms ,
                                  pattern = "anxiety disorders disorderss",
                                   "anxiety disorders"
                          )  
        )

```

```{r}

gbd_data <- data.table::fread(here::here("data/gbd/ihme_gbd_2019_global_disease_burden_rate_all_ages.csv"))

gbd_data$cause <- stringr::str_remove_all(gbd_data$cause, ",")

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l2_all_disease_terms[gwas_study_info$l2_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

gbd_data$cause[!tolower(gbd_data$cause) %in% unique(diseases)] |> sort() |> unique()

```

```{r}

gbd_data =
  gbd_data |>
  mutate(cause = tolower(cause))

gwas_disease_traits = data.frame(cause = diseases)
  # gwas_study_info |>
  # filter(DISEASE_STUDY == T) |>
  # select(all_disease_terms, l1_all_disease_terms, cause = l2_all_disease_terms) |>
  # distinct()

left_join(gwas_disease_traits, 
          gbd_data) |>
  head()

gwas_study_info |> select(cause = l2_all_disease_terms) |>
  distinct() |>
  left_join(gbd_data) |>
  head()

```

```{r}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l2_all_disease_terms[gwas_study_info$l2_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

# make frequency table
freq <- table(as.factor(diseases))

# sort in decreasing order
freq_sorted <- sort(freq, decreasing = TRUE)

# show top N, e.g. top 10
head(freq_sorted, 10)

```

### Save the updated gwas_study_info with harmonized disease terms

```{r}

gwas_study_info <- fwrite(gwas_study_info,
                          here::here("output/gwas_cat/gwas_study_info_trait_group_l2.csv"))

```

