---
title: "Non-ontology based trait collapsing"
author: "Isobel Beasley"
date: "2025-09-06"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---


# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(ggplot2)
library(stringr)

```


```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_study_info_trait_ontology_info.csv"))

```

# Initial summary

## Objectives of this analysis:

- Collapsing and standardizing disease trait terms in GWAS study metadata without relying on ontology mappings.
- Initial harmonization of disease trait terms (fixing spelling, collapsing studies that study different aspects of the same disease)


# Number of studies per trait - before any grouping 

Let's look at the number of studies associated with each unique disease/trait term before any grouping or collapsing.

```{r initial_number_sum}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))

head(n_studies_trait)

dim(n_studies_trait)

```


# Disease trait collapsing and cleaning

```{r}
# Basic cleaning of disease terms
# Removes trailing commas, 
gwas_study_info$all_disease_terms = sub(",$", "", gwas_study_info$all_disease_terms)

# trims whitespace
gwas_study_info$all_disease_terms = stringr::str_trim(gwas_study_info$all_disease_terms)

# remove apostrophes
gwas_study_info$all_disease_terms = stringr::str_remove_all(gwas_study_info$all_disease_terms, "'|’")

# initializes a new column (collected_all_disease_terms) to standardized traits
# collapse more traits 
gwas_study_info = gwas_study_info |> 
  mutate(collected_all_disease_terms = all_disease_terms) 

```


## Where a study investigates a given aspect of of disease, reduce this to a study of this disease

### e.g Susceptibility to X measurement, X disorder measurement etc.

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
        str_replace(collected_all_disease_terms, 
                    "^susceptibility to (.*?) measurement$", "\\1")

         ) |>
    mutate(collected_all_disease_terms = 
        str_replace(collected_all_disease_terms, 
                    "^susceptibility to (.*?) (.*?) measurement$", "\\1")

         ) |>
      mutate(collected_all_disease_terms = 
        str_replace(collected_all_disease_terms, 
                    "^susceptibility to (.*?) (.*?) infection$", "\\1")

         ) 


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
        str_replace(collected_all_disease_terms, 
                    "susceptibility to viral and mycobacterial infections",
                    "viral and mycobacterial infections")

         ) |>
    mutate(collected_all_disease_terms = 
        str_replace(collected_all_disease_terms, 
                    "susceptibility to strep throat",
                    "strep throat")
         )




gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
          stringr::str_remove(collected_all_disease_terms, " symptom severity measurement")
         ) |>
  mutate(collected_all_disease_terms = 
          stringr::str_remove(collected_all_disease_terms, " severity measurement| exacerbation measurement")
         ) 



gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms =
           str_replace_all(collected_all_disease_terms,
                           "\\bdependence\\s+measurement\\b",
                           "dependence")) |> 
  mutate(collected_all_disease_terms =
           str_replace_all(collected_all_disease_terms,
                           "\\ballergy\\s+measurement\\b",
                           "allergy")) |> 
  mutate(collected_all_disease_terms =
           str_replace_all(collected_all_disease_terms,
                           "\\baddiction\\s+measurement\\b",
                           "addiction")) |> 
      mutate(collected_all_disease_terms =
           str_replace_all(collected_all_disease_terms,
                           "\\bsyndrome\\s+measurement\\b",
                           "syndrome")) |> 
      mutate(collected_all_disease_terms =
           str_replace_all(collected_all_disease_terms,
                           "\\bdisorder\\s+measurement\\b",
                           "disorder")) 

```

### e.g age of onset of

```{r}

gwas_study_info = gwas_study_info |>
      mutate(collected_all_disease_terms = 
         stringr::str_remove(collected_all_disease_terms,
                         pattern = "age of onset of "))


gwas_study_info = 
gwas_study_info |> 
 mutate(collected_all_disease_terms  = 
          stringr::str_replace_all(collected_all_disease_terms ,
                                  pattern = "age of onset of type 2 diabetes mellitus",
                                   "type 2 diabetes mellitus"
                          )  
        )

```

### e.g. Family history of 

```{r}

gwas_study_info = gwas_study_info |>
      mutate(collected_all_disease_terms = 
         stringr::str_remove(collected_all_disease_terms,
                         pattern = "family history of "))


gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "family history of alzheimer’s disease",
                          "alzheimers disease"
         ))


```


### Time to remission

#### COVID

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "time to remission of covid-19 symptoms",
                          "covid-19"
         ))


```

### Symptom measurement

#### ADHD

```{r}

gwas_study_info = gwas_study_info |> 
  mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "adhd symptom measurement",
                            "adhd")
         )

```

#### Agoraphobia

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "agoraphobia symptom measurement",
                          "agoraphobia"
         ))

```

#### Alzheimer's disease - neuropathological change

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "alzheimer disease neuropathological change",
                          "alzheimers disease"
         ))

```


#### Asthma

```{r}

gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "asthma exacerbation measurement",
                          "asthma"
         )) |>
  mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "asthma symptoms measurement",
                            "asthma"
           )) 
      
```

#### COVID symptoms 

```{r}
gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "covid-19 symptoms measurement",
                          "covid-19")
  )

```

#### Irritable bowel syndrome

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "irritable bowel syndrome symptom measurement",
                          "irritable bowel syndrome"
         ))


```

### Obsessive compulsive disorder

```{r}


```


#### Parkinson's disease

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "parkinsons disease symptom measurement",
                          "parkinsons disease"
         ))

```

#### PTSD

```{r}

gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "post-traumatic stress disorder symptom measurement",
                          "post-traumatic stress disorder"
         ))

```





#### Respiratory symptom change

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "respiratory symptom change measurement" ,
                          "respiratory symptom measurement" 
         ))

```




### Measurement

#### Anxiety disorder

```{r}


gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "anxiety disorder measurement",
                          "anxiety disorder"
         ))


```

#### Coronary atherosclerosis

```{r} 

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "coronary atherosclerosis measurement",
                          "coronary atherosclerosis")
  ) 

``` 


### Insommnia 

```{r}


gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "insomnia measurement",
                          "insomnia"
         ))

```

#### Lewy body dementia

```{r}

gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "lewy body dementia measurement",
                          "lewy body dementia"
         ))

```


#### Psychosis predisposition 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
        stringr::str_replace_all(collected_all_disease_terms,
                         "psychosis predisposition measurement",
                         "psychosis predisposition")
        )

```


#### Sleep apnea measurement

```{r}

gwas_study_info = gwas_study_info |>
        mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "sleep apnea measurement",
                          "sleep apnea"
         ))

```

#### Susceptibility to infectious disease

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
        str_replace(collected_all_disease_terms, 
                    "susceptibility to infectious disease measurement",
                    "susceptibility to infectious disease")
         )


```






### Substance abuse measurement

#### Alcohol 

```{r}

gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "alcohol dependence measurement",
                          "alcohol dependence"
         ))


```

#### Cannibis 

```{r}
  
gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "cannabis dependence measurement",
                          "cannabis dependence"
         ))

```

#### Cocaine

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "cocaine use disorder|cocaine dependence",
                          "cocaine-related disorders"
         ))


```


#### Nicotine 

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "nicotine dependence symptom count",
                          "nicotine dependence"
         ))

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "nicotine withdrawal symptom count|nicotine withdrawal measurement",
                          "nicotine withdrawal"
         ))


```

## Deal with basic synonyms


### Carcinoma = Cancer

```{r}
  

gwas_study_info = gwas_study_info |>
      mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "\\bcarcinoma",
                            "cancer")
         )

gwas_study_info = gwas_study_info |>
      mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "triple-negative breast cancer",
                            "breast cancer"
           ))


```

### Coronary artery disease = coronary atherosclerosis

https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001645

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "coronary atherosclerosis",
                          "coronary artery disease"
         ))

```

### Head and neck cancer = head and neck malignant neoplasia

```{r}


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "head and neck malignant neoplasia",
                          "head and neck cancer"
         ))

```


### Hepatitis virus infection = hepatitis infection

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "hepatitis a virus infection",
                          "hepatitis a infection"
         )) |>
      mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "hepatitis b virus infection",
                          "hepatitis b infection"
         )) |>
        mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "hepatitis c virus infection",
                          "hepatitis c infection"
         ))

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "chronic hepatitis c virus infection",
                          "chronic hepatitis, hepatitis c infection"
         )) |>
      mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "chronic hepatitis b virus infection",
                          "chronic hepatitis, hepatitis b infection"
         ))

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "hepatitis virus-related liver cancer",
                          "hepatitis, liver cancer"
         ))


```


### HIV 

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "hiv-1 infection",
                          "hiv infection"
         ))


```


### Mumps virus infection = mumps

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "mumps virus infectious disease",
                          "mumps"
         ))


```

### Renal cancer = kidney cancer

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "renal cancer",
                          "kidney cancer"
         ))
  
```  

### Rubella infect = rubella

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "rubella infection",
                          "rubella"
         ))


```



```{r}



gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "multiple sclerosis symptom measurement",
                          "multiple sclerosis"
         ))  




```

### Autism = Autism Spectrum Disorder = Asperger Syndrome

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
        stringr::str_replace_all(collected_all_disease_terms,
                         "autism spectrum disorder",
                         "autism")
        ) |>
    mutate(collected_all_disease_terms = 
        stringr::str_replace_all(collected_all_disease_terms,
                         "asperger syndrome",
                         "autism")
        )



```

## Type 1 diabetes = type 1 diabetes mellitus

```{r}


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
        stringr::str_replace_all(collected_all_disease_terms,
                         "type 1 diabetes mellitus",
                         "type 1 diabetes")
        ) |>
    mutate(collected_all_disease_terms = 
        stringr::str_replace_all(collected_all_disease_terms,
                         "type 1 diabetes",
                         "type 1 diabetes mellitus")
        )


```

### ADHD = attention deficit hyperactivity disorder
  
```{r}
gwas_study_info = gwas_study_info |> 
    mutate(collected_all_disease_terms = 
           stringr::str_replace_all(collected_all_disease_terms,
                            "attention deficit hyperactivity disorder",
                            "adhd"
         ))

```

## Narcolepsy = Narcolepsy without cataplexy

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          "narcolepsy without cataplexy",
                          "narcolepsy"
         ))

```



## Typos 

### Alzheimer -> alzheimers

```{r}
gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms =
         stringr::str_replace_all(collected_all_disease_terms,
                          "alzheimer disease",
                          "alzheimers disease"
         ))



```

### Parkinson -> parkinsons

```{r}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms =
         stringr::str_replace_all(collected_all_disease_terms,
                          "parkinson disease",
                          "parkinsons disease"
         ))

```



# Putting it all together

```{r}

gwas_study_info = gwas_study_info |>
  rowwise() |>
  mutate(
    collected_all_disease_terms = paste0(
      unique(unlist(stringr::str_split(collected_all_disease_terms, ", "))),
      collapse = ", "
    )
  ) |>
  ungroup()

           
gwas_study_info$collected_all_disease_terms = stringr::str_trim(gwas_study_info$collected_all_disease_terms)
gwas_study_info$collected_all_disease_terms = sub(",$", "", gwas_study_info$collected_all_disease_terms)

```


## Final summary - number of studies per trait - after harmonization

```{r}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(collected_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(collected_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))

head(n_studies_trait)

dim(n_studies_trait)

```


```{r}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$collected_all_disease_terms)  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

```


### Save the updated gwas_study_info with harmonized disease terms

```{r}

gwas_study_info <- fwrite(gwas_study_info,
                          here::here("output/gwas_study_info_trait_ontology_info.csv"))

```

