---
title: "Global burden of disease statistics"
author: "Isobel Beasley"
date: "2025-09-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r setup_packages, message=FALSE}

library(data.table)
library(dplyr)
library(ggplot2)
library(stringr)

```

# Global burden of disease statistics

```{r load_data}

gbd_data <- data.table::fread(here::here("data/gbd/ihme_gbd_2019_global_disease_burden_rate_all_ages.csv"))

gbd_data[1:5, 1:5]

```


## Top non-communicable diseases by DALYs (2019)

```{r}

top_non_comm_diseases = 
  gbd_data |>
  slice_max(n = 15, order_by = val) |>
  pull(cause)

print(top_non_comm_diseases)

```

### Global disease burden - top 15 non-communicable diseases by DALYs (2019)

```{r}
plot = 
gbd_data |>
slice_max(n = 15, order_by = val) |>
ggplot(aes(x = reorder(cause, val), y = val)) +
  geom_col(fill = "steelblue") +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.3) +
  coord_flip() +
  labs(
    x = "Disease",
    y = "DALYs (rate per 100,000)",
    title = "Non-communicable diseases with the greatest global disease durden (DALYs - 2019)"
  ) +
  theme_minimal(base_size = 30)

```
## Distribution of DALYs (rate per 100,000) for non-communicable diseases (2019)


```{r}
plot = 
gbd_data |>
  ggplot(aes(x = val)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  labs(
    x = "DALYs (rate per 100,000)",
    y = "# non-communicable diseases",
    title = "Distribution of DALYs (rate per 100,000) for non-communicable diseases (2019)"
  ) +
  theme_minimal(base_size = 30)

```


# Population Attributable Fraction (PAF) for risk factors for non-communicable diseases (2021)

## Load PAF data 

```{r}

gbd_paf_sep <- data.table::fread(here::here("data/gbd/ihme_gbd_2019_global_paf_rate_percent_all_ages.csv"))

gbd_paf_data <-
  gbd_paf_sep |>
  filter(metric == "Percent") |>
  filter(rei == "All risk factors")

gbd_paf_sep[1:5, 1:5]

```

## Integrate with DALY data

```{r}

gbd_paf_data =
left_join(gbd_paf_data,
          gbd_data |> select(cause, daly_rate = val)) |>
  mutate(across(c(val, lower, upper), ~ ifelse(.x < 0, 0, .x))) |>
  mutate(paf_total = daly_rate * (1- val)) |>
  mutate(paf_total_lower = daly_rate * (1-lower)  ) |>
  mutate(paf_total_upper = daly_rate * (1-upper)  ) 

```

### Top 25 non-communicable diseases by % DALYs explained by all risk factors (2019)

```{r}
plot = 
gbd_paf_data |>
  slice_max(n = 25, order_by = val) |>
  ggplot(aes(y = val, x = reorder(cause, val))) + 
  geom_col(fill = "steelblue") +
  theme_bw(base_size = 30) +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.3) +
  coord_flip() +
  labs(y = "% DALYs explained by all risk factors",
       x = "Disease"
       )

```

### Top 15 non-communicable diseases by DALYs not explained by measured environmental risk factors (2019)

```{r}

gbd_paf_data |>
  slice_max(n = 15, order_by = paf_total) |>
  ggplot(aes(y= paf_total, x = reorder(cause, paf_total))) +
  geom_col(fill = "steelblue") +
  theme_bw() +
  geom_errorbar(aes(ymin = paf_total_lower, 
                    ymax = paf_total_upper), width = 0.3) +
  coord_flip() +
  labs(y = "DALYs (rate per 100,000) not explained by measured environmental risk factors",
       x = "Disease",
       title = "Non-communicable diseases with the greatest global disease durden (DALYs - 2019)")

```

### Distribution of DALYs not explained by measured environmental risk factors (2019)

```{r}

gbd_paf_data |>
  ggplot(aes(x = paf_total)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  labs(
    x = "DALYs (rate per 100,000) not explained by measured environmental risk factors",
    y = "# non-communicable diseases",
    title = "Distribution of DALYs (rate per 100,000) not explained by measured environmental risk factors (2019)"
  ) +
  theme_minimal(base_size = 14)

```

### Dalys not explained by measured environmental risk factors for top non-communicable diseases by DALYs (2019)

```{r}

gbd_paf_data |>
  filter(cause %in% top_non_comm_diseases) |>
  ggplot(aes(x= reorder(cause, daly_rate), y = paf_total)) +
  geom_col(fill = "steelblue") +
  theme_bw() +
  coord_flip() +
  labs(y = "DALYs (rate per 100,000)",
       x = "Disease",
       title = "DALYs (rate per 100,000) for top non-communicable diseases (2019)")
 
```

# PAF separated by risk factor type

```{r}

gbd_paf_sep <-
  gbd_paf_sep |>
  filter(metric == "Percent") |>
  filter(rei != "All risk factors")

gbd_paf_sep[1:5, 1:5]

```

```{r top_paf}

# check does this match the total PAF data?
gbd_paf_sep_top = 
gbd_paf_sep |>
  filter(rei != "Drug use") |>
  group_by(cause) |>
  summarise(val = 1 - prod(1 - val)) |>
  arrange(desc(val), cause) 

gbd_paf_sep_top |> head()

causes = gbd_paf_sep_top$cause

dplyr::all_equal(
        gbd_paf_sep_top,
         gbd_paf_data |> 
          dplyr::filter(cause %in% causes) |> 
          dplyr::select(cause, val) |> 
          dplyr::arrange(desc(val), cause)
         )

```
