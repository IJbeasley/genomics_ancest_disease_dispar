---
title: "Level 1 Disease Trait Grouping - Non-cancer"
author: "Isobel Beasley"
date: "2025-09-08"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(stringr)

```

## Ontology help - for getting disease subtypes

```{r ontology_fns}

source(here::here("code/get_term_descendants.R"))

```

```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_cat/gwas_study_info_disease_trait_simplified.csv"))

```

# Initial summary

## Objectives of this analysis:

Level 1 disease grouping: 
-   collapse disease causes, e.g. contact dermatitis due to nickel to contact dermatitis
-   collapse disease subtypes, e.g. bipolar I and bipolar II to bipolar disorder
-   collapse disease onset times, e.g. early-onset alzheimers disease and late-onset alzheimers disease to alzheimers disease
-   collapse disease stages


## Grouping - level 1 set up 

```{r group_l1}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = collected_all_disease_terms)

```

## Initial summary - number of unique study terms

```{r}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(collected_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(collected_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))

head(n_studies_trait)

dim(n_studies_trait)

```

### When separate studies with multiple terms 

```{r}

diseases <- stringr::str_split(pattern = ", ", 
 gwas_study_info$collected_all_disease_terms[gwas_study_info$collected_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

```


# Disease stage grouping

## Chronic kidney disease (CKD)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "chronic kidney disease stage 5|chronic kidney disease stage 4",
                          "chronic kidney disease"
         ))


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "stage 5 chronic kidney disease",
                          "chronic kidney disease"
         ))

```

# Disease cause grouping

## Contact dermatitis

```{r}


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "contact dermatitis due to nickel",
                          "contact dermatitis"
         ))



```

# Disease complication

```{r disease_complication}

disease_complication_terms = c("device complication",
                             "trauma complication",
                             "adverse effect",
                             "aseptic loosening"
                             )

gwas_study_info = gwas_study_info |>
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = paste0(disease_complication_terms, collapse = "(?=,|$)|\\b"),
                                   "complication"
                          )  
        )

```

# Disease subtype grouping (non-cancer)

## Abornmal total eosinophil count

```{r abnormal_total_eosinophil_count}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/hp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0020064/descendants"

abnormal_total_eosinophil_count_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(abnormal_total_eosinophil_count_terms, collapse = "(?=,|$)|\\b"),
                          "abnormal total eosinophil count"
         ))


```

## Abortion

```{r pregnancy_loss}

pregnancy_loss_terms <- c("habitual abortion",
                          "incomplete abortion",
                          "spontaneous abortion",
                          "abortion",
                          "spontaneous loss of pregnancy",
                          "incomplete loss of pregnancy"
                          )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          paste0(pregnancy_loss_terms, collapse = "(?=,|$)|\\b"),
                          "loss of pregnancy"
         ))

# exact synonyms (to avoid partial matches
# https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_1001491?lang=en

```

## Acute pancreatitis

```{r acute_pancreatitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "asparaginase-induced acute pancreatitis",
                          "acute pancreatitis"
         ))

```

## Age-related macular degeneration

```{r age_related_macular_degeneration}

# from: http://purl.obolibrary.org/obo/HP_0011141
age_related_macular_degeneration_terms <- c("age-related cortical cataract",
                                             "age-related nuclear cataract",
                                             "age-related posterior subcapsular cataract"
                                         )

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001365/descendants"

age_related_macular_degeneration_terms <- c(age_related_macular_degeneration_terms,
                                             get_descendants(url)
                                             )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(age_related_macular_degeneration_terms, collapse = "(?=,|$)|\\b"),
                          "age-related macular degeneration"
         ))


```

## Alopecia

```{r alopecia, eval = F}

url<-  "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0004907/descendants"

alopecia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(alopecia_terms, collapse = "(?=,|$)|\\b"),
                          "alopecia"
         ))


```

## Alcohol-use disorders

```{r alchol_use_disorders}

alchol_use_disorder_terms <- c("alcohol dependence",
                             "alcohol withdrawal",
                             "alcohol withdrawal delirium",
                             "alcohol abuse",
                             "alcohol-related disorders delirium",
                             "alcohol use disorder",
                             "addictive alcohol use"
                             )

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms = 
           stringr::str_replace_all(l1_all_disease_terms,
                            paste0(alchol_use_disorder_terms, collapse = "(?=,|$)|\\b"),
                            "alcohol-related disorders"
           ))

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms = 
           stringr::str_replace_all(l1_all_disease_terms,
                            paste0(alchol_use_disorder_terms, collapse = "(?=,|$)|\\b"),
                            "alcohol-related disorders"
           ))


```


## Alcoholic liver disease

```{r alcoholic_liver_disease}

alcoholic_liver_disease_terms <- c("alcoholic liver cirrhosis",
                                   "alcoholic fatty liver disease",
                                   "alcoholic hepatitis"
                                   )


gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms = 
           stringr::str_replace_all(l1_all_disease_terms,
                             paste0(alcoholic_liver_disease_terms, collapse = "(?=,|$)|\\b"),
                            "alcoholic liver disease"
           ))

```

## Alzheimer's disease

```{r alzheimers_disease}}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "early-onset alzheimers disease|late-onset alzheimers disease",
                          "alzheimers disease"
         ))

```

## Allergic contact dermatitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "allergic contact dermatitis of eyelid",
                          "allergic contact dermatitis"
         ))

```

## Allergic rhinitis

```{r allergic_rhinitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "seasonal allergic rhinitis",
                          "allergic rhinitis"
         ))

```

## Aplastic anemia

```{r aplastic_anemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0015909/descendants"

aplastic_anemia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(aplastic_anemia_terms, collapse = "(?=,|$)|\\b"),
                          "aplastic anemia"
         ))

```

## Astigmatism

```{r astigmatism}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "corneal astigmatism",
                          "astigmatism"
         ))

```

## Asthma

```{r asthma}

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                            "atopic asthma|chronic obstructive asthma",
                            "asthma"
           )) |>
    mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                            "childhood onset asthma|adult onset asthma|aspirin-induced asthma",
                            "asthma"
           ))

```

## Autoimmune pancreatitis

```{r autoimmune_pancreatitis}

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                            "autoimmune pancreatitis type 1",
                            "autoimmune pancreatitis"
           )) 


```

## Bipolar disorder

```{r bipolar_disorder}

gwas_study_info = gwas_study_info |> 
    mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "bipolar ii disorder|bipolar i disorder",
                          "bipolar disorder"
         ))

```

## Bundle branch block 

```{r bundle_branch_block}

bundle_branch_block_terms <- c("left bundle branch block",
                             "right bundle branch block",
                             "complete right bundle branch block"
                             )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(bundle_branch_block_terms, collapse = "(?=,|$)|\\b"),
                          "bundle branch block"
         )
  )

```

## Cardiomyopathy

```{r cardiomyopathy}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/hp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0001638/descendants"

cardiomyopathy_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(cardiomyopathy_terms, collapse = "(?=,|$)|\\b"),
                          "cardiomyopathy"
         ))


```

## Carotid artery disease

```{r carotid_artery_disease}

carotid_artery_disease_terms <- c("carotid artery thrombosis",
                             "carotid atherosclerosis"
                             )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(carotid_artery_disease_terms, collapse = "(?=,|$)|\\b"),
                          "carotid artery disease"
         ))

```

## Cataract

```{r cataract}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0005129/descendants"

cataract_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(cataract_terms, collapse = "(?=,|$)|\\b"),
                          "cataract"
         ))


```

## Celiac disease

```{r celiac_disease}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "refractory celiac disease",
                                   "celiac disease"
                          )  
        )


```

## Charcot-marie-tooth disease type 1a

```{r charcot_marie_tooth_disease_type_1a}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "charcot-marie-tooth disease type 1a, decreased fine motor function",
                          "charcot-marie-tooth disease type 1a"
         ))


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "charcot-marie-tooth disease type 1a, decreased walking ability",
                          "charcot-marie-tooth disease type 1a"
         ))

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "charcot-marie-tooth disease type 1a, gait imbalance",
                          "charcot-marie-tooth disease type 1a, gait disturbance"
         ))



```

## Chronic pain

```{r chronic_pain}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0012532/descendants"

cchronic_pain_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(cchronic_pain_terms, collapse = "(?=,|$)|\\b"),
                          "chronic pain"
         ))

```

## Chronic pancreatitis

```{r chronic_pancreatitis, eval = F}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "thiopurine immunosuppressant-induced pancreatitis|non-alcoholic pancreatitis",
                          "chronic pancreatitis"
         ))

```

## Chronic rhinosinusitis 

```{r chronic_rhinosinusitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "chronic rhinosinusitis with nasal polyps",
                          "chronic rhinosinusitis"
         ))

```


## Coronary artery disease

```{r coronary_artery_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001645/descendants"

coronary_artery_disease_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(coronary_artery_disease_terms, collapse = "(?=,|$)|\\b"),
                          "coronary artery disease"
         ))

```

## Communication disorder

```{r communication_disorder}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0002182/descendants"

communication_disorder_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(communication_disorder_terms, collapse = "(?=,|$)|\\b"),
                          "communication disorder"
         ))


```

## Congestive heart failure

```{r congestive_heart_failure}

congestive_heart_failure_terms <- c("systolic heart failure",
                                 "diastolic heart failure",
                                 "cor pulmonale",
                                 "congenital heart disease",
                                 "chronic pulmonary heart disease"
                                 )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(congestive_heart_failure_terms, collapse = "(?=,|$)|\\b"),
                          "congestive heart failure"
         ))

```

## Creutzfeldt jacob disease

```{r creutzfeldt_jacob_disease}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "sporadic creutzfeld jacob disease",
                          "creutzfeldt jacob disease"
         ))

```

## Dental caries

```{r dental_caries}


dental_caries_terms <- c("pit and fissure surface dental caries",
                         "smooth surface dental caries",
                         "primary dental caries",
                         "enamel caries",
                         "permanent dental caries"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(dental_caries_terms, collapse = "(?=,|$)|\\b"),
                          "dental caries"
         )
)

```

## Dermatitis

```{r dermatitis}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_2723/descendants"

dermatitis_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(dermatitis_terms, collapse = "(?=,|$)|\\b"),
                          "dermatitis"
         ))


```

## Drug allergy

```{r drug_allergy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "beta-lactam allergy",
                          "drug allergy"
         ))

```

## Diabetic eye disease

```{r}

diabetic_eye_terms <- c("diabetic maculopathy",
                        "diabetic macular edema",
                        "diabetic retinopathy",
                        "proliferative diabetic retinopathy",
                        "non-proliferative diabetic retinopathy",
                        "diabetes mellitus type 2 associated cataract")


gwas_study_info = 
  gwas_study_info |> 
  mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms ,
                                    pattern = paste0(diabetic_eye_terms, collapse = "(?=,|$)|\\b"),
                                    "diabetic eye disease"
           )  
  )

```


## Diabetic neuropathy

```{r diabetic_nephropathy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "diabetic polyneuropathy",
                          "diabetic neuropathy"
         ))

```

## Deficiency anemia

```{r deficiency_anemia}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "iron deficiency anemia",
                          "deficiency anemia"
         ))

```

## Endocarditis

```{r endocarditis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "bacterial endocarditis",
                          "endocarditis"
         ))

```

## Food allergy

```{r food_allergy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "peanut allergy|milk allergy|egg allergy|wheat allergic reaction",
                          "food allergy"
         ))
```

## Glaucoma

```{r glaucoma}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0005041/descendants"

glaucoma_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(glaucoma_terms, collapse = "(?=,|$)|\\b"),
                          "glaucoma"
         ))


```

## Gout

```{r gout}

# from: http://www.ebi.ac.uk/efo/EFO_0004274
gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "renal overload-type gout",
                          "gout"
         ))

```

## Heart block 

```{r heart_block}

heart_block_terms <- c("first degree atrioventricular block",
                      "second degree atrioventricular block",
                      "third-degree atrioventricular block",
                      "bundle branch block"
                      )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(heart_block_terms, collapse = "(?=,|$)|\\b"),
                          "heart block"
         ))

```

## Hemolytic anemia

```{r hemolytic_anemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0003664/descendants"


hemolytic_anemia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(hemolytic_anemia_terms, collapse = "(?=,|$)|\\b"),
                          "hemolytic anemia"
         ))

```

## Hernia of the abdominal wall 

```{r hernia_abdominal_wall}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/hp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0004299/children"

hernia_abdominal_wall_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(hernia_abdominal_wall_terms, collapse = "(?=,|$)|\\b"),
                          "hernia of the abdominal wall"
         ))


```

## Herpes

```{r}


gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "herpes simplex infection",
                                   "herpesviridae infectious disease"
                          )  
        )


```

## Hypertension

```{r}

url <-  "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000537/descendants"

hypertension_terms <- get_descendants(url)

hypertension_terms = c("primary hypertension",
                      hypertension_terms
                      )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(hypertension_terms, collapse = "(?=,|$)|\\b"),
                          "hypertension"
         ))

```




## HIV 

```{r}

gwas_study_info = gwas_study_info |>
    mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "hiv-1 infection",
                          "hiv infection"
         ))


```

## Hyperlipidemia

```{r}

hyperlipidemia_terms <- c("hypercholesterolemia",
                         "familial hypercholesterolemia",
                         "familial hyperlipidemia"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(hyperlipidemia_terms, collapse = "(?=,|$)|\\b"),
                          "hyperlipidemia"
         ))
  
```

## Idiopathic generalized epilepsy

```{r idiopathic_generalized_epilepsy}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F36803009/descendants"

idiopathic_generalized_epilepsy_terms <- get_descendants(url)

idiopathic_generalized_epilepsy_terms = stringr::str_remove_all(
                                        idiopathic_generalized_epilepsy_terms, 
                                        " \\(disorder\\)$"
                                        )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(idiopathic_generalized_epilepsy_terms, collapse = "(?=,|$)|\\b"),
                          "idiopathic generalized epilepsy"
         ))


```

## Inborn errors of metabolism

```{r}

inborn_error_metab <- c("inborn disorder of amino acid metabolism",
                        "inborn disorder of amino acid transport",
                        "inborn disorder of porphyrin metabolism",
                        "inborn carbohydrate metabolic disorder",
                        "familial lipoprotein lipase deficiency",
                        "lactose intolerance",
                        "hereditary hemochromatosis",
                        "alpha 1-antitrypsin deficiency",
                        "urea cycle disorder",
                        "gaucher disease",
                        "plasma protein metabolism disease",
                        "disorder of metabolite absorption and transport")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(inborn_error_metab, collapse = "(?=,|$)|\\b"),
                          "inborn errors of metabolism"
         ))


```

## Infectious meningitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "bacterial meningitis|pneumococcal meningitis|viral meningitis",
                          "infectious meningitis"
         ))

```

## Infertility (female & male)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "tubal factor infertility",
                          "female infertility"
                          )) |>
  mutate(l1_all_disease_terms  = 
                  stringr::str_replace_all(l1_all_disease_terms,
                          "azoospermia",
                          "male infertility"
                          )  )

```

## Influenza a (h1n1) (subset of influenza)

```{r}

gwas_study_info = gwas_study_info |>
    mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "influenza a \\(h1n1\\)",
                          "influenza"
         ))

```

## Intestinal obstruction

```{r intestinal_obstruction}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0004565/descendants"

intestinal_obstruction_terms <- get_descendants(url)

# also add: http://purl.obolibrary.org/obo/DOID_8437

intestinal_obstruction_terms = c(intestinal_obstruction_terms,
                                 "intestinal impaction"
                                 )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(intestinal_obstruction_terms, collapse = "(?=,|$)|\\b"),
                          "intestinal obstruction"
         ))


```

## Juvenile idiopathic arthritis

```{r juvenile_idiopathic_arthritis_onset_group}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms ,
                         "systemic juvenile idiopathic arthritis|oligoarticular juvenile idiopathic arthritis|
                         polyarticular juvenile idiopathic arthritis",
                         "juvenile idiopathic arthritis")
        )

```

## Lewy body dementia

```{r lewy_body_dementia}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "lewy body attribute",
                          "lewy body dementia"
         ))


```
## Malaria

```{r malaria}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "plasmodium falciparum malaria|plasmodium vivax malaria",
                          "malaria"
         ))

```

## Methamphetamine use disorders 

```{r methamphetamine_use_disorders}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "methamphetamine dependence|methamphetamine-induced psychosis",
                          "methamphetamine use disorders"
         ))

```

## Migrane 

```{r migraine}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "migraine disorder|migraine with aura|migraine without aura",
                          "migraine"
         ))

```

## Multiple sclerosis

```{r multiple_sclerosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "relapsing-remitting multiple sclerosis",
                          "multiple sclerosis"
         ))

```

## Myocardial infarction

```{r myocardial_infarction}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000612/descendants"

myocardial_infarction_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(myocardial_infarction_terms, collapse = "(?=,|$)|\\b"),
                          "myocardial infarction"
         ))

```

## Photosensitivity disease

```{r photosensitivity_disease}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms,
                         "phototoxic dermatitis|skin sensitivity to sun",
                         "photosensitivity disease")
        )

```

## Phobic disorder

```{r phobic_disorder}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_1001908/descendants"

phobic_disorder_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(phobic_disorder_terms, collapse = "(?=,|$)|\\b"),
                          "phobic disorder"
         ))

```

## Hereditary heterochromatosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "hereditary hemochromatosis type 1",
                          "hereditary hemochromatosis"
         ))

```




## Myasthenia gravis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "late-onset myasthenia gravis",
                          "myasthenia gravis"
         ))


```



## Neuromyelitis optica 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "aqp4-igg-negative neuromyelitis optica|aqp4-igg-positive neuromyelitis optica",
                          "neuromyelitis optica"
         ))

```

## Neurofibromatosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "neurofibromatosis type 1|neurofibromatosis type 2",
                          "neurofibromatosis"
         ))

```

## Non-alcoholic fatty liver disease (NAFLD)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "non-alcoholic steatohepatitis|non-alcoholic liver disease",
                          "non-alcoholic fatty liver disease"
         ))

```


## Obesity

```{r}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = "morbid obesity|metabolically healthy obesity",
                                   "obesity"
                          )  
        )

```


## Obsessive-compulsive disorder

```{r obsessive_compulsive_disorder}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "obsessive-compulsive trait",
                          "obsessive-compulsive disorder"
         ))

```


## Osteoarthritis

```{r osteoarthritis}

osteoarthritis_terms <- c("knee osteoarthritis",
                         "hip osteoarthritis",
                         "hand osteoarthritis",
                         "spine osteoarthritis",
                         "toe osteoarthritis"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(osteoarthritis_terms, collapse = "(?=,|$)|\\b"),
                          "osteoarthritis"
         )
  )

```

## Pancreatitis 

```{r pancreatitis}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000278/descendants"

pancreatitis_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(pancreatitis_terms, collapse = "(?=,|$)|\\b"),
                          "pancreatitis"
         ))


```

## Pericardium disorder

```{r pericardium_disorder}

pericardium_disorder_terms <- c("pericarditis",
                               "pericardial effusion"
                               )

```

## Poisoning

```{r poisoning}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "carbon monoxide poisoning",
                          "poisoning"
         ))

```

## Polycythemia

```{r polycythemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0005804/descendants"

polycythemia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(polycythemia_terms, collapse = "(?=,|$)|\\b"),
                          "polycythemia"
         ))

```

## Psoriasis

```{r}

psoriasis_terms <- c("psoriasis vulgaris",
                      "psoriasis area and severity index",
                      "cutaneous psoriasis",
                      "psoriatic arthritis",
                     "parapsoriasis")


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(psoriasis_terms, collapse = "(?=,|$)|\\b"),
                          "psoriasis")
  )

```


## Psychosis

```{r psychosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "psychosis predisposition",
                          "psychosis")
         )

```


## Rheumatoid arthritis

```{r}

ra_terms <- c("acpa-positive rheumatoid arthritis",
               "acpa-negative rheumatoid arthritis",
              "adult-onset stills disease")

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = paste0(ra_terms, collapse = "(?=,|$)|\\b"),
                                   "rheumatoid arthritis"
                          )  
        )

```

## Schizoaffective disorder

```{r schizoaffective_disorder}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "schizoaffective disorder-bipolar type",
                          "schizoaffective disorder")
         )

```

## Schizophrenia

```{r schizophrenia}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "treatment refractory schizophrenia",
                          "schizophrenia")
         )

```

## Sciatica

```{r sciatica}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "^ldh-related sciatica, ",
                          "sciatica, lumbar disc herniation")
         )

```

## Scoliosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "adolescent idiopathic scoliosis",
                          "scoliosis")
         )

```

## Sickle cell disease 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "sickle cell anemia",
                          "sickle cell disease and related diseases")
         )

```

## Sleep apnea 

```{r}

sleep_apnea_terms <- c("sleep apnea measurement during non-rem sleep",
                      "sleep apnea measurement during rem sleep",
                      "obstructive sleep apnea")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(sleep_apnea_terms, collapse = "(?=,|$)|\\b"),
                          "sleep apnea")
  )


```

## Staphylococcus aureus infection

```{r staphylococcus_aureus_infection}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "methicillin-resistant staphylococcus aureus infection",
                          "staphylococcus aureus infection"
         ))

```

## Stroke

https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000712?lang=en

```{r}


hemorrhage_terms <- c("intracerebral hemorrhage",
                      "non-lobar intracerebral hemorrhage",
                      "lobar intracerebral hemorrhage")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(hemorrhage_terms, collapse = "(?=,|$)|\\b"),
                          "hemorrhagic stroke")
  )

stroke_terms <- c("stroke outcome",
                  "large artery stroke",
                  "small vessel stroke",
                  "ischemic stroke",
                  "stroke disorder",
                  "cardioembolic stroke",
                  "hemorrhagic stroke",
                  "intracranial hemorrhage",
                  "subdural hemorrhage"
                  )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          paste0(stroke_terms, collapse = "(?=,|$)|\\b"),
                          "stroke")
  )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "post-operative stroke",
                          "post-operative, stroke")
  )

```

## Tacycardia

```{r tacycardia}

tacycardia_terms <- c("paroxysmal tachycardia",
                     "ventricular tachycardia",
                     "supraventricular tachycardia",
                     "paroxysmal supraventricular tachycardia",
                     "paroxysmal ventricular tachycardia"
                     )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(tacycardia_terms, collapse = "(?=,|$)|\\b"),
                          "tacycardia"
         )
  )

```

## Systemic scleroderma

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000717/descendants"

scleroderma_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(scleroderma_terms, collapse = "(?=,|$)|\\b"),
                          "systemic scleroderma"
         ))

```

## Tenosynovitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms,
                         "stenosing tenosynovitis",
                         "tenosynovitis")
        )

```

## Type 1 diabetes

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "latent autoimmune diabetes in adults",
                          "type 1 diabetes mellitus"
         ))

```

## Thrombocytopenia

```{r thrombocytopenia}

thrombocytopenia_terms <- c("thrombocytopenia 4",
                           "acquired thrombocytopenia",
                           "primary thrombocytopenia"
                           )

```

## Tinea 

```{r}

tinea_terms <- c("tinea pedis",
                 "tinea unguium",
                 "dermatophytosis"
                 )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(tinea_terms, collapse = "(?=,|$)|\\b"),
                          "tinea"
         ))

```

## Vitamin b deficiency

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          "vitamin b12 deficiency",
                          "vitamin b deficiency"
         ))

```


## Visual impairment

```{r visual_impairment}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0000505/descendants"

visual_impairment_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = paste0(visual_impairment_terms, collapse = "(?=,|$)|\\b"),
                          "visual impairment"
         ))

```



# Final summary - number of unique study terns

## Deal with duplicate terms created during grouping

```{r}

gwas_study_info = 
 gwas_study_info |>
  rowwise() |>
  mutate(l1_all_disease_terms = paste0(sort(unique(unlist(strsplit(l1_all_disease_terms, ", ")))),
                                      collapse = ", ")
         )


```

```{r final_summary}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(l1_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(l1_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))


head(n_studies_trait)

dim(n_studies_trait)

```

### When separate studies with multiple terms

```{r final_diseases}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l1_all_disease_terms[gwas_study_info$l1_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()


test <- data.frame(trait = unique(diseases))

length(unique(diseases))

# make frequency table
freq <- table(as.factor(diseases))

# sort in decreasing order
freq_sorted <- sort(freq, decreasing = TRUE)

# show top N, e.g. top 10
head(freq_sorted, 10)

```

### Save the updated gwas_study_info with harmonized disease terms

```{r}

fwrite(gwas_study_info,
        here::here("output/gwas_cat/gwas_study_info_group_l1.csv")
         )

```



