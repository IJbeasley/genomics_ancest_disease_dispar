---
title: "Level 1 Disease Trait Grouping - Non-cancer"
author: "Isobel Beasley"
date: "2025-09-08"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(stringr)

```

## Ontology help - for getting disease subtypes

```{r ontology_fns}

source(here::here("code/get_term_descendants.R"))

```


```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_cat/gwas_study_info_disease_trait_filtered_v2.csv"))

```

# Initial summary

## Objectives of this analysis:

Level 1 disease grouping: 
-   collapse disease causes, e.g. contact dermatitis due to nickel to contact dermatitis
-   collapse disease subtypes, e.g. bipolar I and bipolar II to bipolar disorder
-   collapse disease onset times, e.g. early-onset alzheimers disease and late-onset alzheimers disease to alzheimers disease
-   collapse disease stages
-   collapse disease complications, e.g. device complication, trauma complication to complication

## Grouping - level 1 set up 

```{r group_l1}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = collected_all_disease_terms)

```

## Initial summary - number of unique study terms

### When separate studies with multiple terms 

```{r}

diseases <- stringr::str_split(pattern = ", ", 
 gwas_study_info$collected_all_disease_terms[gwas_study_info$collected_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

```


# Disease complications 

## Nervous system complications caused by herpes zoster

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern("herpes zoster, nervous system disease"),
                          "nervous system disease"
                          )
         )

```

## herpes zoster, psoriasis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern("herpes zoster, psoriasis"),
                          "psoriasis"
         )
         )


```

## herpes zoster, rheumatoid arthritis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern("herpes zoster, rheumatoid arthritis"),
                          "rheumatoid arthritis"
                          
         )
         )

```


# Disturbances to senses 

```{r disturbances_to_senses}

disturb_senses_terms <- c("disturbances of sensation of smell and taste",
                          "abnormality of the sense of smell",
                          "ageusia")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(disturb_senses_terms),
                          "disturbances to senses"
         )
         )

```


# Disease stage grouping

## Chronic kidney disease (CKD)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("chronic kidney disease stage 5"),
                          "chronic kidney disease"
         ))


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("stage 5 chronic kidney disease"),
                          "chronic kidney disease"
         ))

```

# Disease cause grouping

## Contact dermatitis

```{r}

pattern <- vec_to_grep_pattern("contact dermatitis due to nickel")


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = pattern,
                          "contact dermatitis"
         ))



```

# Disease complication

```{r disease_complication}

disease_complication_terms = c("device complication",
                             "trauma complication",
                             "adverse effect",
                             "aseptic loosening"
                             )

pattern <- vec_to_grep_pattern(disease_complication_terms)

gwas_study_info = gwas_study_info |>
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = pattern,
                                   "complication"
                          )  
        )

```


# Cardiovascular diseases

## Hypertension

### Pulmonary arterial hypertension

```{r pulmonary_arterial_hypertension}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001361/descendants"

pulmonary_arterial_hypertension_terms <- get_descendants(url)

pattern <- vec_to_grep_pattern(pulmonary_arterial_hypertension_terms)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = pattern,
                          "pulmonary arterial hypertension"
         ))

```

### Atrial fibrillation & flutter

### Atrial fibrillation

```{r atrial_fibrillation}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("post-operative atrial fibrillation"),
                          "atrial fibrillation, post-operative"
         ))



url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F49436004/descendants"

atrial_fibrillation_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(atrial_fibrillation_terms),
                          "atrial fibrillation"
         ))

```

#### Atrial flutter

```{r atrial_flutter}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F5370000/descendants"

atrial_flutter_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(atrial_flutter_terms),
                          "atrial flutter"
         ))

```

## Heart disease

### Hypertensive heart disease

```{r hypertensive_heart_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F64715009/descendants"

hypertensive_heart_disease_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(hypertensive_heart_disease_terms),
                          "hypertensive heart disease"
         ))

```

### Ischemic heart disease

```{r ischemic_heart_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/cvdo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_3394/descendants"

ischemic_heart_disease_terms <- get_descendants(url)

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F414545008/descendants"

ischemic_heart_disease_terms_snomed <- get_descendants(url)

ischemic_heart_disease_terms = c(ischemic_heart_disease_terms,
                                 ischemic_heart_disease_terms_snomed
                                 ) |>
                                str_length_sort()

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(ischemic_heart_disease_terms),
                          "ischemic heart disease"
         ))

```

#### Coronary artery disease

Likely also add, as ICD10 I25.1, seems to be coronary artery disease
And gbd includes this in ischemic heart disease

```{r coronary_artery_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001645/descendants"

coronary_artery_disease_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(coronary_artery_disease_terms),
                          #pattern = paste0(coronary_artery_disease_terms, collapse = "(?=,|$) |\\b"),
                          "coronary artery disease"
         ))

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern("coronary artery disease"),
                          # "coronary artery disease",
                          "ischemic heart disease"
         ))

```

#### Myocardial infarction

```{r myocardial_infarction}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000612/descendants"

myocardial_infarction_terms <- get_descendants(url)

myocardial_infarction_terms <- c("subsequent st elevation \\(stemi\\) and non-st elevation \\(nstemi\\) myocardial infarction",
                              myocardial_infarction_terms
                              )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(myocardial_infarction_terms), 
                          #pattern = paste0(myocardial_infarction_terms, collapse = "(?=,|$) |\\b"),
                                  "myocardial infarction"
                          )
         )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern("post-operative myocardial infarction"),
                          "myocardial infarction, post-operative"
         ))

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern("myocardial infarction"),
                          "ischemic heart disease"
         ))

```

#### Fixing

```{r fix_ischemic_heart_disease}


to_fix <- c("non-st elevation ischemic heart disease",
            "post-operative ischemic heart disease",
            "st elevation ischemic heart disease",
            "subsequent st elevation \\(stemi\\) and non-st elevation \\(nstemi\\) ischemic heart disease")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(to_fix),
                          #paste0(to_fix, collapse = "(?=,|$) |\\b"),
                          "ischemic heart disease"
         ))


```


### (Non-rheumatic) Heart valvular disease

```{r heart_valvular_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0009551/descendants"

heart_valve_disease_terms <- get_descendants(url)

# make non-rheumatic 
rheumatic_terms <- c("rheumatic pulmonary valve disease",
                     "rheumatic disease of mitral valve")

heart_valve_disease_terms <- 
  heart_valve_disease_terms[!heart_valve_disease_terms %in% rheumatic_terms]

gwas_study_info = gwas_study_info |> 
          mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                   pattern = vec_to_grep_pattern(heart_valve_disease_terms),
                                  # pattern = paste0(heart_valve_disease_terms, 
                                  #                  collapse = "(?=,|$) |\\b"),
                                   "heart valve disease"
                                  )  
          )

```

## Other cardiovascular diseases (GBD)

### Aortic aneurysm

```{r aortic_aneurysm}

aortic_aneurysm_terms <- c("thoracic aortic aneurysm",
                          "abdominal aortic aneurysm"
                          )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(aortic_aneurysm_terms),
                          # pattern = paste0(aortic_aneurysm_terms, collapse = "(?=,|$) |\\b"),
                          "aortic aneurysm"
         ))

```


### Endocarditis

```{r endocarditis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("bacterial endocarditis"),
                          "endocarditis"
         ))

```

### Cardiomyopathy

```{r cardiomyopathy}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/hp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0001638/descendants"

cardiomyopathy_terms <- get_descendants(url)

cardiomyopathy_terms <- c("chagas cardiomyopathy",
                          "ischemic cardiomyopathy",
                          "idiopathic cardiomyopathy",
                          "nonischemic cardiomyopathy",
                          "peripartum cardiomyopathy", #? maybe include in pregnancy 
                          cardiomyopathy_terms
                          )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(cardiomyopathy_terms),
                          # pattern = paste0(cardiomyopathy_terms, collapse = "(?=,|$) |\\b"),
                          "cardiomyopathy"
         ))

gwas_study_info =
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms ,
                                  pattern = vec_to_grep_pattern("\\bidiopathic cardiomyopathy\\b"),
                                   "cardiomyopathy"
                          )  
        )


```


### Stroke

https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000712?lang=en

```{r}


hemorrhage_terms <- c("intracerebral hemorrhage",
                      "non-lobar intracerebral hemorrhage",
                      "lobar intracerebral hemorrhage",
                      "parenchymal hematoma")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(hemorrhage_terms),
                          # pattern = paste0(hemorrhage_terms, collapse = "(?=,|$) |\\b"),
                          "hemorrhagic stroke")
  )

stroke_terms <- c("stroke outcome",
                  "large artery stroke",
                  "small vessel stroke",
                  "ischemic stroke",
                  "stroke disorder",
                  "cardioembolic stroke",
                  "hemorrhagic stroke",
                  "intracranial hemorrhage",
                  "subdural hemorrhage"
                  )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(stroke_terms),
                          # paste0(stroke_terms, collapse = "(?=,|$) |\\b"),
                          "stroke")
  )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("post-operative stroke"),
                          "post-operative, stroke")
  )

```

### Lower extremity peripheral artery disease

```{r peripheral_artery_disease}

# studies in gwas catalog don't specify lower or upper extremity
# but most peripheral artery disease is in lower extremities

gwas_study_info =
 gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("\\bperipheral artery disease|\\bperipheral arterial disease"),
                          "lower extremity peripheral arterial disease"
         ))

```


## Other (non-GBD)

### Carotid artery disease

```{r carotid_artery_disease}

carotid_artery_disease_terms <- c("carotid artery thrombosis",
                             "carotid atherosclerosis"
                             )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(carotid_artery_disease_terms),
                          # pattern = paste0(carotid_artery_disease_terms, collapse = "(?=,|$) |\\b"),
                          "carotid artery disease"
         ))

```


### Other hypertension

```{r}

url <-  "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000537/descendants"

hypertension_terms <- get_descendants(url)

hypertension_terms = c("primary hypertension",
                       "chronic venous hypertension",
                       "portal hypertension",
                      hypertension_terms
                      )

hypertension_terms = hypertension_terms[!hypertension_terms %in% 
                                        c(pulmonary_arterial_hypertension_terms,
                                          hypertensive_heart_disease_terms,
                                          "pulmonary arterial hypertension",
                                          "hypertensive heart disease"
                                          )
                                        ]

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(hypertension_terms),
                          # pattern = paste0(hypertension_terms, collapse = "(?=,|$) |\\b"),
                          "hypertension"
         ))

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(hypertension_terms),
                          # pattern = paste0(hypertension_terms, collapse = "(?=,|$) |\\b"),
                          "hypertension"
         ))

```

### Heart block 

### Bundle branch block 

```{r bundle_branch_block}

bundle_branch_block_terms <- c("left bundle branch block",
                             "right bundle branch block",
                             "complete right bundle branch block"
                             )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(bundle_branch_block_terms),
                          "bundle branch block"
         )
  )

```

```{r heart_block}

heart_block_terms <- c("first degree atrioventricular block",
                      "second degree atrioventricular block",
                      "third-degree atrioventricular block",
                      "atrioventricular block",
                      "bundle branch block",
                      "complete right heart block",
                      "left heart block"
                      )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(heart_block_terms),
                          # pattern = paste0(heart_block_terms, collapse = "(?=,|$) |\\b"),
                          "heart block"
         ))

```

### Tachycardia

```{r tacycardia}

tacycardia_terms <- c("paroxysmal tachycardia",
                     "ventricular tachycardia",
                     "supraventricular tachycardia",
                     "paroxysmal supraventricular tachycardia",
                     "paroxysmal ventricular tachycardia"
                     )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(tacycardia_terms),
                          # pattern = paste0(tacycardia_terms, collapse = "(?=,|$) |\\b"),
                          "tachycardia"
         )
  )

```

### Cardiac arrest

```{r cardiac_arrest}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                         vec_to_grep_pattern("sudden cardiac arrest"),
                          "cardiac arrest"
         )
  )

```

### Other cardiac arrhythmias

```{r other_cardiac_arrhythmias}

other_cardiac_arrhythmia_terms <- c("ventricular fibrillation",
                                   "ventricular arrhythmia",
                                   "cardiac arrest",
                                   "bradycardia",
                                   "cardiac arrhythmia"
                                   )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(other_cardiac_arrhythmia_terms),
                          # pattern = paste0(other_cardiac_arrhythmia_terms, collapse = "(?=,|$) |\\b"),
                          "other cardiac arrhythmias"
         )
  )


```

### Congenital heart disease/s

```{r congenital_heart_disease}

congenital_heart_disease_terms <- c(
  "heart septal defect",  
  "atrial heart septal defect",
  
  "congenital left-sided heart lesions",
  "congenital right-sided heart lesions",
  
  "congenital anomaly of the great arteries", # equiv = "Congenital malformation of great arteries, unspecified"
  
  # malformation of cardiac septum, 
    "abnormal cardiac septum morphology",
    "atrioventricular canal defect"
)
  

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0005207/descendants"

congenital_heart_disease_terms <- c(congenital_heart_disease_terms,
                                  get_descendants(url)
                                  ) |>
  unique()

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(congenital_heart_disease_terms),
                          "congenital heart disease"
         )
  )


url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0024239/descendants"

more_congenital_heart_disease_terms <- get_descendants(url)

congenital_heart_disease_terms <- c(congenital_heart_disease_terms,
                                  more_congenital_heart_disease_terms
                                  ) |>
  unique() |>
  str_length_sort()


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(congenital_heart_disease_terms),
                          "congenital anomaly of cardiovascular system"
         )
  )

```


### Abnormal cardiovascular system morphology

```{r abnormal_cardiovascular_system_morphology}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMP_0002127/descendants"

mp_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(mp_terms),
                          "abnormal cardiovascular system morphology"
         )
  )

```

### Thrombosis

```{r thrombosis}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0000831/descendants"

thrombosis_terms <- get_descendants(url)

thrombosis_terms <- c("abnormal thrombosis",
                      thrombosis_terms)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(thrombosis_terms),
                          # pattern = paste0(thrombosis_terms, collapse = "(?=,|$) |\\b"),
                          "thrombotic disease"
         )
  )

```

### Arterial occlusion

```{r arterial_occlusion}

arterial_occlusion_terms <- c("cerebral artery occlusion",
                              "occlusion precerebral artery",
                              "small artery occlusion"
                              )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(arterial_occlusion_terms),
                          # pattern = paste0(arterial_occlusion_terms, collapse = "(?=,|$) |\\b"),
                          "arterial occlusion"
         )
  )


```

### Other vascular disorders / diseases

```{r other_vascular_disorders}

other_vascular_disorder_terms <- c("skin vascular disease",
                                   "peripheral vascular disease",
                                   "vascular disease",
                                   "vasculitis",
                                   "arteritis")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(other_vascular_disorder_terms),
                          "other vascular disorders"
         )
  )


```

## Congestive heart failure

```{r congestive_heart_failure}

congestive_heart_failure_terms <- c("systolic heart failure",
                                 "diastolic heart failure",
                                 "cor pulmonale",
                                 "congenital heart disease",
                                 "chronic pulmonary heart disease"
                                 )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(congestive_heart_failure_terms),
                          # pattern = paste0(congestive_heart_failure_terms, collapse = "(?=,|$) |\\b"),
                          "congestive heart failure"
         ))

```

## Brain infarction

```{r brain_infarction}

brain_infarction_terms <- c("cerebral infarction",
                          "mri defined brain infarct",
                          "small cerebral infarction"
                          )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(brain_infarction_terms),
                          # pattern = paste0(brain_infarction_terms, collapse = "(?=,|$) |\\b"),
                          "brain infarction"
         ))

```

## Vascular insufficiency

```{r vascular_insufficiency}

vascular_insufficiency_terms <- c("vascular insufficiency disorder",
                                 "chronic venous insufficiency",
                                  "chronic intestinal vascular insufficiency"
                                 )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(vascular_insufficiency_terms),
                          # pattern = paste0(vascular_insufficiency_terms, collapse = "(?=,|$) |\\b"),
                          "vascular insufficiency"
         )
  )

```

# Disease subtype grouping (non-cancer)

## Abornmal total eosinophil count

```{r abnormal_total_eosinophil_count}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/hp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0020064/descendants"

abnormal_total_eosinophil_count_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(abnormal_total_eosinophil_count_terms),
                          # pattern = paste0(abnormal_total_eosinophil_count_terms, collapse = "(?=,|$) |\\b"),
                          "abnormal total eosinophil count"
         ))


```

## Abortion

```{r pregnancy_loss}

pregnancy_loss_terms <- c("habitual abortion",
                          "incomplete abortion",
                          "spontaneous abortion",
                          "abortion",
                          "spontaneous loss of pregnancy",
                          "incomplete loss of pregnancy"
                          )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(pregnancy_loss_terms),
                          # paste0(pregnancy_loss_terms, collapse = "(?=,|$) |\\b"),
                          "loss of pregnancy"
         ))

# exact synonyms (to avoid partial matches
# https://www.ebi.ac.uk/ols4/ontologies/efo/classes/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_1001491?lang=en

```

## Acute pancreatitis

```{r acute_pancreatitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("asparaginase-induced acute pancreatitis"),
                          "acute pancreatitis"
         ))

```

## Age-related macular degeneration

```{r age_related_macular_degeneration}

# from: http://purl.obolibrary.org/obo/HP_0011141
age_related_macular_degeneration_terms <- c("age-related cortical cataract",
                                             "age-related nuclear cataract",
                                             "age-related posterior subcapsular cataract"
                                         )

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0001365/descendants"

age_related_macular_degeneration_terms <- c(age_related_macular_degeneration_terms,
                                             get_descendants(url)
                                             )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(age_related_macular_degeneration_terms),
                          # pattern = paste0(age_related_macular_degeneration_terms, collapse = "(?=,|$) |\\b"),
                          "age-related macular degeneration"
         ))


```

## Alcohol-use disorders

## Alcoholic liver disease

```{r alcoholic_liver_disease}

alcoholic_liver_disease_terms <- c("alcoholic liver cirrhosis",
                                   "alcoholic fatty liver disease",
                                   "alcoholic hepatitis"
                                   )


gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms = 
           stringr::str_replace_all(l1_all_disease_terms,
                            pattern = vec_to_grep_pattern(alcoholic_liver_disease_terms),
                            "alcoholic liver disease"
           ))

```

## Alzheimer's disease

```{r alzheimers_disease}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(
                                    c("early-onset alzheimers disease",
                                  "late-onset alzheimers disease")),
                          "alzheimers disease"
         ))

```

## Allergic contact dermatitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("allergic contact dermatitis of eyelid"),
                          "allergic contact dermatitis"
         ))

```

## Allergic rhinitis

```{r allergic_rhinitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("seasonal allergic rhinitis"),
                          "allergic rhinitis"
         ))

```

## Aplastic anemia

```{r aplastic_anemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0015909/descendants"

aplastic_anemia_terms <- get_descendants(url)

aplastic_anemia_terms <- c("severe aplastic anemia",
                           aplastic_anemia_terms
                          )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(aplastic_anemia_terms),
                          "aplastic anemia"
         ))

```

## Astigmatism

```{r astigmatism}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("corneal astigmatism"),
                          "astigmatism"
         ))

```

## Asthma

```{r asthma}

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                            vec_to_grep_pattern(c("atopic asthma", "chronic obstructive asthma")),
                            "asthma"
           )) |>
    mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                            vec_to_grep_pattern(c("childhood onset asthma",
                                                    "adult onset asthma",
                                                    "aspirin-induced asthma"
                                                  )
                            ),
                            "asthma"
           ))

```



## Autoimmune pancreatitis

```{r autoimmune_pancreatitis}

gwas_study_info = gwas_study_info |>
      mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                            vec_to_grep_pattern("autoimmune pancreatitis type 1"),
                            "autoimmune pancreatitis"
           )) 


```

## Bipolar disorder

```{r bipolar_disorder}

gwas_study_info = gwas_study_info |> 
    mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern(
                            c("bipolar ii disorder",
                              "bipolar i disorder"
                              )
                            ),
                          "bipolar disorder"
         ))

```


## Cataract

```{r cataract}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0005129/descendants"

cataract_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(cataract_terms),
                          "cataract"
         ))


```

## Celiac disease

```{r celiac_disease}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern("refractory celiac disease"),
                                   "celiac disease"
                          )  
        )


```

## Charcot-marie-tooth disease type 1a

```{r charcot_marie_tooth_disease_type_1a}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("charcot-marie-tooth disease type 1a, decreased fine motor function"),
                          "charcot-marie-tooth disease type 1a"
         ))


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("charcot-marie-tooth disease type 1a, decreased walking ability"),
                          "charcot-marie-tooth disease type 1a"
         ))

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("charcot-marie-tooth disease type 1a, gait imbalance"),
                          "charcot-marie-tooth disease type 1a, gait disturbance"
         ))



```

## Chronic pain

```{r chronic_pain}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0012532/descendants"

chronic_pain_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(chronic_pain_terms),
                          "chronic pain"
         ))

```

## Chronic rhinosinusitis 

```{r chronic_rhinosinusitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("chronic rhinosinusitis with nasal polyps"),
                          "chronic rhinosinusitis"
         ))

```

## Cholecystitis

```{r cholecystitis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("acute cholecystitis"),
                          "cholecystitis"
         ))

```

## Communication disorder

```{r communication_disorder}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0002182/descendants"

communication_disorder_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(communication_disorder_terms),
                          "communication disorder"
         ))


```



## Creutzfeldt jacob disease

```{r creutzfeldt_jacob_disease}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("sporadic creutzfeld jacob disease"),
                          "creutzfeldt jacob disease"
         ))

```

## Delirium

```{r delirium}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("post-operative delirium"),
                          "delirium, post-operative"
         ))

```

## Dental caries

```{r dental_caries}


dental_caries_terms <- c("pit and fissure surface dental caries",
                         "smooth surface dental caries",
                         "primary dental caries",
                         "enamel caries",
                         "permanent dental caries"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(dental_caries_terms),
                          "dental caries"
         )
)

```

## Dermatitis

```{r dermatitis}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_2723/descendants"

dermatitis_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(dermatitis_terms),
                          "dermatitis"
         ))

# see: http://www.ebi.ac.uk/efo/EFO_0000274
eczema_terms <- c("atopic eczema",
                 "hand eczema",
                 "eczematoid dermatitis", # see: http://purl.obolibrary.org/obo/HP_0000964
                 "recalcitrant dermatitis" # assuming same as recalcitrant atopic dermatitis http://www.ebi.ac.uk/efo/EFO_1000651
                 )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(eczema_terms),
                          "dermatitis"
         ))

```

## Drug allergy

```{r drug_allergy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("beta-lactam allergy"),
                          "drug allergy"
         ))

```

## Diabetic eye disease

```{r}

diabetic_eye_terms <- c("diabetic maculopathy",
                        "diabetic macular edema",
                        "diabetic retinopathy",
                        "proliferative diabetic retinopathy",
                        "non-proliferative diabetic retinopathy",
                        "diabetes mellitus type 2 associated cataract")


gwas_study_info = 
  gwas_study_info |> 
  mutate(l1_all_disease_terms  = 
           stringr::str_replace_all(l1_all_disease_terms,
                                    pattern = vec_to_grep_pattern(diabetic_eye_terms),
                                    "diabetic eye disease"
           )  
  )

```


## Diabetic neuropathy

```{r diabetic_nephropathy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("diabetic polyneuropathy"),
                          "diabetic neuropathy"
         ))

```

## Deficiency anemia

```{r deficiency_anemia}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("iron deficiency anemia"),
                          "deficiency anemia"
         ))

```

## Encephalopathy

```{r encephalopathy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("delayed encephalopathy after acute poisoning"),
                          "encephalopathy, poisoning"
         ))


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("encephalopathy acute infection-induced"),
                          "encephalopathy"
         ))

```

## Food allergy

```{r food_allergy}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  vec_to_grep_pattern(
                                    c("peanut allergy",
                                      "milk allergy",
                                      "egg allergy",
                                      "wheat allergic reaction"
                                     )),
                          "food allergy"
         ))
```

## Glaucoma

```{r glaucoma}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0005041/descendants"

glaucoma_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(glaucoma_terms),
                          "glaucoma"
         ))


```

## Gout

```{r gout}

# from: http://www.ebi.ac.uk/efo/EFO_0004274
gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("renal overload-type gout"),
                          "gout"
         ))

```


## Graft vs host disease

```{r graft_vs_host_disease}

graft_vs_host_terms <- c("chronic graft versus host disease",
                         "chronic graft vs. host disease",
                         "acute graft versus host disease",
                         "acute graft vs. host disease"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern(graft_vs_host_terms),
                          "graft versus host disease"
         ))

```



## Hemolytic anemia

```{r hemolytic_anemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0003664/descendants"


hemolytic_anemia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(hemolytic_anemia_terms),
                          "hemolytic anemia"
         ))

```

## Hereditary progressive muscular distrophy

```{r hereditary_progressive_muscular_dystrophy}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F193225000/descendants"

hereditary_progressive_muscular_dystrophy_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(hereditary_progressive_muscular_dystrophy_terms),
                          "hereditary progressive muscular dystrophy"
         ))

```

## Hernia of the abdominal wall 

```{r hernia_abdominal_wall}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/hp/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0004299/children"

hernia_abdominal_wall_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(hernia_abdominal_wall_terms),
                          "hernia of the abdominal wall"
         ))


```

## Hyperaldosteronism

```{r hyperaldosteronism}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("primary hyperaldosteronism"),
                          "hyperaldosteronism"
         ))

```

## Hyperlipidemia

```{r}

hyperlipidemia_terms <- c("hypercholesterolemia",
                         "familial hypercholesterolemia",
                         "familial hyperlipidemia"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(hyperlipidemia_terms),
                          "hyperlipidemia"
         ))
  
```

## Idiopathic generalized epilepsy

```{r idiopathic_generalized_epilepsy}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F36803009/descendants"

idiopathic_generalized_epilepsy_terms <- get_descendants(url)

idiopathic_generalized_epilepsy_terms = stringr::str_remove_all(
                                        idiopathic_generalized_epilepsy_terms, 
                                        " \\(disorder\\)$"
                                        )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(idiopathic_generalized_epilepsy_terms),
                          "idiopathic generalized epilepsy"
         ))


```

## Inborn errors of metabolism

```{r}

inborn_error_metab <- c("inborn disorder of amino acid metabolism", # ICD9:270, ICD9:270.9
                        "inborn disorder of amino acid transport", # ICD9:270.0
                        "inborn disorder of porphyrin metabolism", # ? ebi suggests ... ICD10CM:E80.4 - doesn't seem right match, but close - E80 range likely captures it
                        "inborn carbohydrate metabolic disorder", # ICD9:271.8
                        "familial lipoprotein lipase deficiency", # ICD9:272.3
                        "lactose intolerance", # ICD10: E73
                        "hereditary hemochromatosis", # ICD10CM:E83.110, ICD9: 275.01
                        "alpha 1-antitrypsin deficiency", # ICD9:273.4
                        "urea cycle disorder", # ICD9CM:270.6
                        "gaucher disease", # ICD10CM:E75.22, ICD9:272.7
                        "plasma protein metabolism disease", # ? ICD9:273.8
                        "disorder of metabolite absorption and transport"
                        )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(inborn_error_metab),
                          "inborn errors of metabolism"
         ))


```

## Infertility (female & male)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("tubal factor infertility"),
                          "female infertility"
                          )) |>
  mutate(l1_all_disease_terms  = 
                  stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("azoospermia"),
                          "male infertility"
                          )  )

```



## Intestinal obstruction

```{r intestinal_obstruction}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mondo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FMONDO_0004565/descendants"

intestinal_obstruction_terms <- get_descendants(url)

# also add: http://purl.obolibrary.org/obo/DOID_8437

intestinal_obstruction_terms = c(intestinal_obstruction_terms,
                                 "intestinal impaction"
                                 )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(intestinal_obstruction_terms),
                          "intestinal obstruction"
         ))


```



## Juvenile idiopathic arthritis

```{r juvenile_idiopathic_arthritis_onset_group}

jia_terms <- c("systemic juvenile idiopathic arthritis",
                "oligoarticular juvenile idiopathic arthritis",
                "polyarticular juvenile idiopathic arthritis"
                )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms,
                         vec_to_grep_pattern(jia_terms),
                         "juvenile idiopathic arthritis")
        )

```

## Chronic kidney disease 

```{r kidney_disease}


url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0003884/descendants"


kidney_disease_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(kidney_disease_terms),
                          "chronic kidney disease"
         ))


```

## Laryngitis

```{r laryngitis}

laryngitis_terms <- c("acute laryngitis",
                      "chronic laryngitis"
                      )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(laryngitis_terms),
                          "laryngitis"
         ))


```

## Lewy body dementia

```{r lewy_body_dementia}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("lewy body attribute"),
                          "lewy body dementia"
         ))


```

## Migraine 

```{r migraine}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern(
                            c("migraine with aura",
                              "migraine without aura",
                              "migraine disorder"
                              )
                            ),
                          "migraine"
         ))

```

## Multiple sclerosis

```{r multiple_sclerosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("relapsing-remitting multiple sclerosis"),
                          "multiple sclerosis"
         ))

```


## Penile disorder

```{r penile_disorder}

penile_disorder <- c("balanitis",
                     "balanoposthitis",
                     "priapism",
                     "phimosis",
                     "erectile dysfunction",
                     "leukoplakia of penis")


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(penile_disorder),
                          "penile disorder"
         ))


```


## Photosensitivity disease

```{r photosensitivity_disease}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms,
                         vec_to_grep_pattern(
                           c("phototoxic dermatitis",
                           "skin sensitivity to sun"
                           )),
                         "photosensitivity disease")
        )

```

## Phobic disorder

```{r phobic_disorder}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_1001908/descendants"

phobic_disorder_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(phobic_disorder_terms),
                          "phobic disorder"
         ))

```

## Hereditary hemochromatosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("hereditary hemochromatosis type 1"),
                          "hereditary hemochromatosis"
         ))

```

## Mineral metabolism disease

```{r mineral_metabolism_disorder}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0009556/descendants"

mineral_metabolism_disorder_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(mineral_metabolism_disorder_terms),
                          "mineral metabolism disease"
         ))

```

## Myasthenia gravis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("late-onset myasthenia gravis"),
                          "myasthenia gravis"
         ))


```

## Neuromyelitis optica 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern(
                            c("aquaporin-4 antibody positive neuromyelitis optica",
                              "aquaporin-4 antibody negative neuromyelitis optica",
                              "aqp4-igg-positive neuromyelitis optica",
                              "aqp4-igg-negative neuromyelitis optica"
                            )
                          ),
                          "neuromyelitis optica"
         ))

```

## Neurofibromatosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern(
                            c("neurofibromatosis type 1",
                              "neurofibromatosis type 2")
                          ),
                          "neurofibromatosis"
         ))

```

## Non-alcoholic fatty liver disease (NAFLD)

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                                  vec_to_grep_pattern(
                                    c("non-alcoholic steatohepatitis",
                                      "non-alcoholic liver disease"
                                     )
                                   ),
                          "non-alcoholic fatty liver disease"
         ))

```


## Obesity

```{r obesity}

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = 
                                    vec_to_grep_pattern(
                                      c("morbid obesity",
                                         "metabolically healthy obesity"
                                        )
                                      ),
                                   "obesity"
                          )  
        )

```


## Obsessive-compulsive disorder

```{r obsessive_compulsive_disorder}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("obsessive-compulsive trait"),
                          "obsessive-compulsive disorder"
         ))

```

## Orofacial cleft

```{r orofacial_cleft}

orofacial_cleft_terms <- c("cleft lip",
                            "cleft palate"
                            )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(orofacial_cleft_terms),
                          "orofacial cleft"
         ))

```


## Osteoarthritis

```{r osteoarthritis}

osteoarthritis_terms <- c("knee osteoarthritis",
                         "hip osteoarthritis",
                         "hand osteoarthritis",
                         "spine osteoarthritis",
                         "toe osteoarthritis"
                         )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(osteoarthritis_terms),
                          "osteoarthritis"
         )
  )

```


## Osteonecrosis

```{r osteonecrosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("idiopathic osteonecrosis of the femoral head"),
                          "osteonecrosis"
         ))

```

## Ovarian dysfunction

```{r ovarian_dysfunction}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0009003/descendants"

ovarian_dysfunction_terms <- get_descendants(url)

ovarian_dysfunction_terms <- c(ovarian_dysfunction_terms,
                              "premature ovarian failure",
                              "premature ovarian insufficiency"
                              )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(ovarian_dysfunction_terms),
                          "ovarian dysfunction"
         ))

```

## Pancreatitis 

```{r pancreatitis}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000278/descendants"

pancreatitis_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(pancreatitis_terms),
                          "pancreatitis"
         ))


```

## Peridontal disease

```{r periodontal}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_3388/descendants"

periodontal_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(periodontal_terms),
                          "periodontal disease"
         ))

```

## Pituitary gland disease

```{r pituitary_gland_disease}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0009607/descendants"

pituitary_gland_disease_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(pituitary_gland_disease_terms),
                          "pituitary gland disease"
         ))

```

## Polycythemia

```{r polycythemia}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0005804/descendants"

polycythemia_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(polycythemia_terms),
                          "polycythemia"
         ))

```


## Pulmonary embolism

```{r pulmonary_embolism}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("pulmonary embolism, pulmonary infarction"),
                          "pulmonary embolism"
         ))

```

## Pulmonary fibrosis

```{r pulmonary_fibrosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("idiopathic pulmonary fibrosis"),
                          "pulmonary fibrosis"
         ))

```

## Psoriasis

```{r}

psoriasis_terms <- c("psoriasis vulgaris",
                      "psoriasis area and severity index",
                      "cutaneous psoriasis",
                      "psoriatic arthritis",
                     "parapsoriasis")


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(psoriasis_terms),
                          "psoriasis")
  )

```


## Psychosis

```{r psychosis}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("psychosis predisposition"),
                          "psychosis")
         )

```

## Retinopathy

```{r retinopathy}

retinopathy_terms <- c("chronic central serous retinopathy",
                       "central serous retinopathy"
                       )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = 
           stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(retinopathy_terms),
                          "retinopathy")
  )

```


## Rheumatoid arthritis

```{r}

ra_terms <- c("acpa-positive rheumatoid arthritis",
               "acpa-negative rheumatoid arthritis",
              "adult-onset stills disease")

gwas_study_info = 
gwas_study_info |> 
 mutate(l1_all_disease_terms  = 
          stringr::str_replace_all(l1_all_disease_terms,
                                  pattern = vec_to_grep_pattern(ra_terms),
                                   "rheumatoid arthritis"
                          )  
        )

```

## Schizoaffective disorder

```{r schizoaffective_disorder}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("schizoaffective disorder-bipolar type"),
                          "schizoaffective disorder")
         )

```

## Schizophrenia

```{r schizophrenia}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("treatment refractory schizophrenia"),
                          "schizophrenia")
         )

```

## Sciatica

```{r sciatica}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_remove_all(l1_all_disease_terms,
                          "^ldh-related sciatica, |, ldh-related sciatica$"
         )
  )

```

## Scoliosis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("adolescent idiopathic scoliosis"),
                          "scoliosis")
         )

```

## Sickle cell disease 

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("sickle cell anemia"),
                          "sickle cell disease and related diseases")
         )

```

## Sleep apnea 

```{r}

sleep_apnea_terms <- c("sleep apnea during non-rem sleep",
                      "sleep apnea during rem sleep",
                      "obstructive sleep apnea")

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(sleep_apnea_terms),
                          "sleep apnea")
  )


```

## Staphylococcus aureus infection

```{r staphylococcus_aureus_infection}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("methicillin-resistant staphylococcus aureus infection"),
                          "staphylococcus aureus infection"
         ))

```




## Systemic scleroderma

```{r}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fwww.ebi.ac.uk%252Fefo%252FEFO_0000717/descendants"

scleroderma_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(scleroderma_terms),
                          "systemic scleroderma"
         ))

```

## Tenosynovitis

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
        stringr::str_replace_all(l1_all_disease_terms,
                         vec_to_grep_pattern("stenosing tenosynovitis"),
                         "tenosynovitis")
        )

```

## Type 1 diabetes

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("latent autoimmune diabetes in adults"),
                          "type 1 diabetes mellitus"
         ))

```

## Thrombocytopenia

```{r thrombocytopenia}

thrombocytopenia_terms <- c("thrombocytopenia 4",
                           "acquired thrombocytopenia",
                           "primary thrombocytopenia"
                           )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(thrombocytopenia_terms),
                          "thrombocytopenia"
         ))

```

## Tinea 

```{r tinea}

tinea_terms <- c("tinea pedis",
                 "tinea unguium",
                 "dermatophytosis"
                 )


gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(tinea_terms),
                          "tinea"
         ))

```

## Uveitis

```{r uveitis}

uveitis_terms <- c("anterior uveitis"
                   )

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(uveitis_terms),
                          "uveitis"
         ))

```

## Vitamin b deficiency

```{r}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          vec_to_grep_pattern("vitamin b12 deficiency"),
                          "vitamin b deficiency"
         ))

```


## Visual impairment

```{r visual_impairment}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/efo/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0000505/descendants"

visual_impairment_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(visual_impairment_terms),
                          "visual impairment"
         ))

```


# Further grouping of terms

## Abnormal refraction

```{r abnormal_refraction}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/upheno/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FHP_0000539/descendants"

abnormal_refraction_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms  = 
         stringr::str_replace_all(l1_all_disease_terms,
                          pattern = vec_to_grep_pattern(abnormal_refraction_terms),
                          "abnormality of refraction"
         ))

```

# Final summary - number of unique study terms

## Deal with duplicate terms created during grouping

```{r duplicate_terms}

gwas_study_info = 
 gwas_study_info |>
  rowwise() |>
  mutate(l1_all_disease_terms = paste0(sort(unique(unlist(strsplit(l1_all_disease_terms, ", ")))),
                                      collapse = ", ")
         ) |>
  ungroup()

```

## Deal with hanging commas and spaces

```{r clean_hanging_commas}

gwas_study_info = gwas_study_info |>
  mutate(l1_all_disease_terms = stringr::str_remove_all(l1_all_disease_terms, "^,|,$")
         ) |>
  mutate(l1_all_disease_terms = stringr::str_trim(l1_all_disease_terms)
         ) 

```

## Final summary - number of unique study terms pairs 

```{r final_summary}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(l1_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(l1_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))


head(n_studies_trait)

dim(n_studies_trait)

```

### When separate studies with multiple terms

```{r final_diseases}

diseases <- stringr::str_split(pattern = ", ", 
                               gwas_study_info$l1_all_disease_terms[gwas_study_info$l1_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()


test <- data.frame(trait = unique(diseases))

length(unique(diseases))

# make frequency table
freq <- table(as.factor(diseases))

# sort in decreasing order
freq_sorted <- sort(freq, decreasing = TRUE)

# show top N, e.g. top 10
head(freq_sorted, 10)

```

### Save the updated gwas_study_info with harmonized disease terms

```{r}

fwrite(gwas_study_info,
        here::here("output/gwas_cat/gwas_study_info_group_l1.csv")
         )

```



