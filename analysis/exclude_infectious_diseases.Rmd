---
title: "Infectious Disease"
author: "Isobel Beasley"
date: "2025-09-18"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r required_fns, message = F, warning= F}

library(dplyr)
library(data.table)
library(stringr)

```

## Ontology help - for getting disease subtypes

```{r ontology_fns}

source(here::here("code/get_term_descendants.R"))

```

```{r setup_2, message = FALSE, warning= FALSE}

gwas_study_info <- fread(here::here("output/gwas_cat/gwas_study_info_disease_trait_simplified.csv"))

```

## Initial summary - number of unique study terms

### When separate studies with multiple terms 

```{r}

diseases <- stringr::str_split(pattern = ", ", 
 gwas_study_info$collected_all_disease_terms[gwas_study_info$collected_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

```

# HIV/AIDS and sexually transmitted infections

## HIV/AIDS

### HIV subgrouping

```{r hiv_subgrouping}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms = 
         stringr::str_replace_all(collected_all_disease_terms,
                          vec_to_grep_pattern("hiv-1 infection"),
                          "hiv infection"
         ))

```

```{r hiv_aids}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("hiv infection")
         )
         )

```

### AIDS

```{r aids}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("aids")
         )
         )

```

## Sexually transmitted infections (other than HIV)

### Syphilis

```{r syphilis}

gwas_study_info |>
  filter(grepl("syphi", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

### Chlamydial infections

```{r clamydial_infections}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("chlamydophila infectious disease")
         )
         )

```

### Gonorrhea

```{r gonorrhea}

gwas_study_info |>
  filter(grepl("gonorrhea", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

### Trichomoniasis

```{r trichomoniasis}

gwas_study_info |>
  filter(grepl("trichomoniasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

### Genital herpes

```{r genital_herpes}

gwas_study_info |>
  filter(grepl("herpes", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms) |>
  head()

```


### Other sexually transmitted infections

```{r other_stis}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/mesh/terms/http%253A%252F%252Fid.nlm.nih.gov%252Fmesh%252FD012749/descendants"

sti_terms <- get_descendants(url)

for(term in sti_terms){
  
  if(sum(grepl(term, gwas_study_info$collected_all_disease_terms)) > 0) {
    
  print(paste0("Term removed:", term))
    
  gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms  = 
           stringr::str_remove_all(collected_all_disease_terms,
                            pattern = vec_to_grep_pattern(term)
           )
    )
  
  }
}

```



# Respiratory infections and tuberculosis

## Tuberculosis

```{r tuberculosis}

tb_terms <- c("mycobacterium tuberculosis infection",
              "pulmonary tuberculosis",
              "extrapulmonary tuberculosis",
              "meningeal tuberculosis")


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_replace_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern(tb_terms),
                          "tuberculosis"
         ))

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("tuberculosis")
         )
         )

# additionally, remove bacterial infection if `DISEASE/TRAIT` contains:
# Resistance to Mycobacterium tuberculosis infection

gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("Resistance to Mycobacterium tuberculosis infection", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("bacterial infection"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("bacterial infection")),
               collected_all_disease_terms
         ))


```

## Lower respiratory infections

```{r lower_respiratory_infections}

# acute lower respiratory infections
url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F195742007/descendants"


# in the case of acute / chronic bronchitis, we will remove only acute
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("acute bronchitis", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("bronchitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("bronchitis")),
               collected_all_disease_terms
         ))

# if bronchitis is specified as chronic in DISEASE/TRAIT, replace bronchitis with chronic bronchitis
# in to collected_all_disease_terms
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("chronic bronchitis", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("bronchitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_replace_all(collected_all_disease_terms,
                          vec_to_grep_pattern("bronchitis"),
                          "chronic bronchitis"),
               collected_all_disease_terms
         ))


# similar, for bronchiolitis, remove if acute
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("acute bronchiolitis", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("bronchiolitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("bronchiolitis")),
               collected_all_disease_terms
         ))



lri_terms <- get_descendants(url)

lri_terms <- c("acute bronchitis",
               "respiratory syncytial virus infection",
               lri_terms
               )

for(term in lri_terms){
  
  if(sum(grepl(term, gwas_study_info$collected_all_disease_terms)) > 0) {
    
  print(paste0("Term removed:", term))
    
  gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms  = 
           stringr::str_remove_all(collected_all_disease_terms,
                            pattern = vec_to_grep_pattern(term)
           )
    )
  
  }
}

```

## Upper respiratory infections

```{r upper_respiratory_infections}

# remove larygitis, if acute
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("acute laryngitis", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("laryngitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("laryngitis")),
               collected_all_disease_terms
         ))

# if laryngitis is specified as acute in DISEASE/TRAIT, remove disease from collected_all_disease_terms
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("acute laryngitis", `DISEASE/TRAIT`, ignore.case = T) & 
                collected_all_disease_terms == "disease",
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("disease")),
               collected_all_disease_terms
         ))

# if laryngitis is specified as chronic in DISEASE/TRAIT, replace laryngitis with chronic laryngitis
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("chronic laryngitis", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("laryngitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_replace_all(collected_all_disease_terms,
                          vec_to_grep_pattern("laryngitis"),
                          "chronic laryngitis"),
               collected_all_disease_terms
         ))

# for tonsillitis, remove if acute
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("acute tonsillitis|ICD10 J03", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("tonsillitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("tonsillitis")),
               collected_all_disease_terms
         ))

# remove disease, if DISEASE/TRAIT contains acute tonsillitis
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("acute tonsillitis", `DISEASE/TRAIT`, ignore.case = T) & 
                collected_all_disease_terms == "disease",
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("disease")),
               collected_all_disease_terms
         ))

# for tonsillitis, if chronic in DISEASE/TRAIT, replace tonsillitis with chronic tonsillitis
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("chronic tonsillitis", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("tonsillitis"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_replace_all(collected_all_disease_terms,
                          vec_to_grep_pattern("tonsillitis"),
                          "chronic tonsillitis"),
               collected_all_disease_terms
         ))



# acute upper respiratory infections
url <- "http://www.ebi.ac.uk/ols4/api/ontologies/snomed/terms/http%253A%252F%252Fsnomed.info%252Fid%252F54398005/descendants"

uri_terms <- get_descendants(url)

uri_terms <- c("strep throat", 
               "streptococcal pharyngitis",
               "acute pharyngitis",
               "pharyngitis",
               "acute tonsillitis",
               "scarlet fever",
               uri_terms
               )



for(term in uri_terms){
  
  if(sum(grepl(term, gwas_study_info$collected_all_disease_terms)) > 0) {
    
  print(paste0("Term removed:", term))
    
  gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms  = 
           stringr::str_remove_all(collected_all_disease_terms,
                            pattern = vec_to_grep_pattern(term)
           )
    )
  
  }
}

```

## Otitis media

```{r otitis_media}

url <- "http://www.ebi.ac.uk/ols4/api/ontologies/doid/terms/http%253A%252F%252Fpurl.obolibrary.org%252Fobo%252FDOID_10754/descendants"

otitis_media_terms <- get_descendants(url)

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_replace_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern(otitis_media_terms),
                          "otitis media"
         ))


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("otitis media")
         )
         )


# where  collected_all_disease_terms==disease, and otitis media in DISEASE/TRAIT, remove disease

gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("otitis media", `DISEASE/TRAIT`, ignore.case = T) & 
                collected_all_disease_terms == "disease",
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("disease")),
               collected_all_disease_terms
         ))


```

## Covid-19

```{r covid19}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("covid-19")
         )
         )

```

## Other

### Influenza a (h1n1) (subset of influenza)

```{r}

gwas_study_info = gwas_study_info |>
    mutate(collected_all_disease_terms  = 
         stringr::str_replace_all(collected_all_disease_terms,
                          vec_to_grep_pattern("influenza a \\(h1n1\\)"),
                          "influenza"
         ))


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("influenza")
         )
         )

```

# Enteric infections

## Diarrheal diseases

```{r diarrheal_diseases}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("astroviridae infectious disease, infantile diarrhea")
         )
         )

# if diarrhea is caused by IBS, add ibs to collected_all_disease_terms

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
        ifelse(grepl("IBS", `DISEASE/TRAIT`, ignore.case = T) &
               grepl("diarrhea", collected_all_disease_terms, ignore.case = T),
               paste0(collected_all_disease_terms, ", irritable bowel syndrome"),
               collected_all_disease_terms
               )
         )

# remove dysentery
gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("dysentery")
         )
         )


```


## Typhoid and paratyphoid fevers

### Typhoid fever

```{r typhoid_fever}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("typhoid fever")
         )
         )

```

## Invasive Non-typhoidal salmonella

```{r invasive_non_typhoidal_salmonella}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("non-typhoidal salmonella bacteremia")
         )
         )

```

## Other intestinal infectious diseases

### Gastroenteritis

```{r gastroenteritis}

# remove bacterial and viral gastroenteritis

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("gastroenteritis", collected_all_disease_terms, ignore.case = T) &
                grepl("bacterial gastroenteritis|viral gastroenteritis", 
                       collected_all_disease_terms, 
                       ignore.case = T),
          stringr::str_remove_all(collected_all_disease_terms,
          pattern = vec_to_grep_pattern("gastroenteritis")
          ),
          collected_all_disease_terms
         )
         )


```

### Enteritis 

```{r enteritis}

# remove viral and bacterial enteritis
gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("enteritis", collected_all_disease_terms, ignore.case = T) &
                grepl("bacterial enteritis|viral enteritis", 
                       collected_all_disease_terms, 
                       ignore.case = T),
          stringr::str_remove_all(collected_all_disease_terms,
          pattern = vec_to_grep_pattern("enteritis")
          ),
          collected_all_disease_terms
         )
         )


```


### Intestinal infectious disease

```{r intestinal_infectious_disease}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("intestinal infectious disease")
         )
         )

```



# Neglected tropical diseases and malaria

## Malaria

### Plasmodium falciparum and vivax malaria

```{r plasmodium_malaria}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_replace_all(collected_all_disease_terms,
                          vec_to_grep_pattern(
                            c("plasmodium falciparum malaria",
                              "plasmodium vivax malaria"
                              )),
                          "malaria"
         ))

```

```{r malaria}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("malaria")
         )
         )

```

## Chagas disease

```{r chagas_disease}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("chagas disease")
         )
         )

```

## Leishmaniasis

```{r leishmaniasis}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("visceral leishmaniasis")
         )
         )


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("cutaneous leishmaniasis")
         )
         )


```

## African trypanosomiasis

```{r african_trypanosomiasis}

gwas_study_info |>
  filter(grepl("trypanosomiasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Schistosomiasis

```{r schistosomiasis}

gwas_study_info |>
  filter(grepl("schistosomiasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Cysticercosis

```{r cysticercosis}

gwas_study_info |>
  filter(grepl("cysticercosis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Cystic echinococcosis

```{r cystic_echinococcosis}

gwas_study_info |>
  filter(grepl("echinococcosis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Lymphatic filariasis

```{r lymphatic_filariasis}

gwas_study_info |>
  filter(grepl("filariasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Onchocerciasis

```{r onchocerciasis}

gwas_study_info |>
  filter(grepl("onchocerciasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Trachoma

```{r trachoma}

gwas_study_info |>
  filter(grepl("trachoma", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)


```

## Dengue

```{r dengue}

gwas_study_info = 
  gwas_study_info |> 
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("dengue hemorrhagic fever")
         ))

gwas_study_info = 
  gwas_study_info |> 
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                         vec_to_grep_pattern("dengue")
         ))

gwas_study_info |>
  filter(grepl("dengue", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Yellow fever

```{r yellow_fever}

gwas_study_info |>
  filter(grepl("yellow fever", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Rabies

```{r rabies}

gwas_study_info |>
  filter(grepl("rabies", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Intestinal nematode infections

```{r intestinal_nematode_infections}

# ascariasis
gwas_study_info |>
  filter(grepl("ascariasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

# trichuriasis
gwas_study_info |>
  filter(grepl("trichuriasis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

# hookworm
gwas_study_info |>
  filter(grepl("hookworm", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)


```

## Food borne trematode infections

```{r food_borne_trematode_infections}

gwas_study_info |>
  filter(grepl("trema", collected_all_disease_terms, ignore.case = T) 
         ) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)


```


## Leprosy

```{r leprosy}

gwas_study_info |>
  filter(grepl("leprosy", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms) |>
  distinct()

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("leprosy")
         )
         )

```

## Ebola

```{r ebola}

gwas_study_info |>
  filter(grepl("ebola", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Zika virus

```{r zika_virus}

gwas_study_info |>
  filter(grepl("zika", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```


## Guinea worm disease

```{r guinea_worm_disease}

gwas_study_info |>
  filter(grepl("worm", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

```

## Other neglected tropical diseases

```{r other_neglected_tropical_diseases}

other_ntd_terms <- c("typhus"
                     )

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern(other_ntd_terms)
         )
  )


```

# Other infectious diseases

## Meningitis

```{r meningitis}

meningitis_terms <- c(
                     "meningococcal infection",
                     "infectious meningitis",
                     "bacterial meningitis",
                     "viral meningitis",
                     "pneumococcal meningitis",
                     "meningitis"
                     )

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern(meningitis_terms)
         )
         )

```

## Encephalitis

```{r encephalitis}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("viral encephalitis")
         )
         )


# ? also remove if DISEASE/TRAIT == Encephalitis (PheCode 323)

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(`DISEASE/TRAIT` == "Encephalitis (PheCode 323)",
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("encephalitis")
                          ),
         collected_all_disease_terms
         )
  )

```

## Diphtheria

```{r diptheria}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("diphtheria")
         )
         )

```

## Pertussis

```{r pertussis}

gwas_study_info |>
  filter(grepl("pertussis", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)


```

## Tetanus

```{r tetanus}

gwas_study_info |>
  filter(grepl("tetanus", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms) 


```

## Measles

```{r measles}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("measles")
         )
         )

```

## Varicella and herpes zoster

```{r varicella_herpes_zoster}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("chickenpox")
         )
         )


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(`DISEASE/TRAIT` == "Herpes zoster (PheCode 53)" |
                `DISEASE/TRAIT` == "Herpes zoster" |
                `DISEASE/TRAIT` == "Zoster infection" |
                grepl("ICD10 B02: Zoster \\[herpes zoster\\]", `DISEASE/TRAIT`),
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("herpes zoster")
                          ),
         collected_all_disease_terms
         )
  )


gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_replace_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("complication, herpes zoster, nervous system disease"),
                          "herpes zoster, nervous system disease"
                          
         )
         )

```

## Shingles 

```{r shingles}

# remove shingles ... ICD9 053.9 - included in varicella and herpes zoster by gbd
gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("shingles")
         )
         )

```

## Acute hepatitis

```{r acute_hepatitis}

# if acute hepatitis in DISEASE/TRAIT remove from collected_all_disease_terms
gwas_study_info |> 
  filter(grepl("acute hepat", 
                 `DISEASE/TRAIT`, 
                  ignore.case = T)) |> 
  pull(`DISEASE/TRAIT`) |>
  unique()

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(`DISEASE/TRAIT` == "Acute hepatitis A infection",
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("hepatitis a infection")
                          ),
         collected_all_disease_terms
         )
  )

```


## Other unspecified infectious diseases

### Bacterial pneumonia

```{r bacterial_pneumonia}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("bacterial pneumonia")
         )
         )

```


### Infectious mononucleosis

```{r infectious_mononucleosis}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("infectious mononucleosis")
         )
         )

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("epstein-barr virus infection")
         )
         )

```

### Protozoa infectious disease

```{r protozoa_infectious_disease}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("protozoa infectious disease")
         )
         )

```

### Herpes

```{r}


gwas_study_info = 
gwas_study_info |> 
 mutate(collected_all_disease_terms  = 
        ifelse(grepl("herpes simplex", `DISEASE/TRAIT`, ignore.case = T) &
               grepl("herpesviridae infectious disease", collected_all_disease_terms, ignore.case = T),
          stringr::str_replace_all(collected_all_disease_terms,
                                  pattern = vec_to_grep_pattern("herpesviridae infectious disease"),
                                  "herpes simplex infection"),
          collected_all_disease_terms
               )
          ) 


# cold sores
gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_replace_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("cold sores"),
                          "herpes simplex infection"
         )
         )


gwas_study_info |>
  filter(grepl("herpes", collected_all_disease_terms, ignore.case = T)) |>
  pull(`DISEASE/TRAIT`) |>
  unique()


```

### Mumps 

```{r mumps}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("mumps")
         )
         )

```

### Parasitic infection

```{r parasitic_infection}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("parasitic infection")
         )
         )


```

### Helicobacter pylori infection

```{r helicobacter_pylori_infection}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("helicobacter pylori infectious disease")
         )
         )

```

### Common cold

```{r common_cold}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("common cold")
         )
         )

```

### Tropical spastic paraparesis


```{r tropical_spastic_paraparesis}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("tropical spastic paraparesis")
         )
         )

```

### Unspecified streptococcal infection

```{r unspecified_streptococcal_infection}

# remove streptococcal infection if DISEASE/TRAIT contains Streptococcus infection (PheCode 41.2)
gwas_study_info = 
  gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         ifelse(grepl("Streptococcus infection \\(PheCode 41.2\\)", `DISEASE/TRAIT`, ignore.case = T) & 
                grepl(vec_to_grep_pattern("streptococcal infection"), 
                      collected_all_disease_terms, 
                      ignore.case = T,
                      perl = T),
         stringr::str_remove_all(collected_all_disease_terms,
                          vec_to_grep_pattern("streptococcal infection")),
               collected_all_disease_terms
         ))

```

### Any acute infection

```{r any_acute_infection}

diseases <- stringr::str_split(pattern = ", ", 
 gwas_study_info$collected_all_disease_terms[gwas_study_info$collected_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

infection_terms <- diseases[grepl("infection", diseases, ignore.case = T)]

# if acute is in DISEASE/TRAIT and infection term in collected_all_disease_terms, remove infection term

for(term in infection_terms){
  
  if(sum(grepl(term, gwas_study_info$collected_all_disease_terms)) > 0) {
    
    print(paste0("Term removed:", term))
    
    gwas_study_info = 
      gwas_study_info |>
      mutate(collected_all_disease_terms  = 
             ifelse(grepl("acute", `DISEASE/TRAIT`, ignore.case = T) & 
                    grepl(vec_to_grep_pattern(term), 
                          collected_all_disease_terms, 
                          ignore.case = T,
                          perl = T),
             stringr::str_remove_all(collected_all_disease_terms,
                              vec_to_grep_pattern(term)),
                   collected_all_disease_terms
             ))
    
  }
}

```

### Rubella

```{r rubella}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("rubella")
         )
         )

```

## lassa fever

```{r lassa_fever}

gwas_study_info |>
  filter(grepl("lassa", collected_all_disease_terms, ignore.case = T)) |>
  select(`DISEASE/TRAIT`, collected_all_disease_terms)

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms  = 
         stringr::str_remove_all(collected_all_disease_terms,
                          pattern = vec_to_grep_pattern("lassa fever")
         )
         )

```

### HPV infection

```{r hpv_infection}


```

```{r other_unspecified_infectious_diseases}


# parasitic infection



```


# Update and save output 

## Deal with duplicate terms created during grouping

```{r duplicate_terms}

gwas_study_info = 
 gwas_study_info |>
  rowwise() |>
  mutate(collected_all_disease_terms = paste0(sort(unique(unlist(strsplit(collected_all_disease_terms, ", ")))),
                                      collapse = ", ")
         ) |>
  ungroup()


```

## Deal with hanging commas and spaces

```{r clean_hanging_commas}

gwas_study_info = gwas_study_info |>
  mutate(collected_all_disease_terms = stringr::str_remove_all(collected_all_disease_terms, "^,|,$")
         ) |>
  mutate(collected_all_disease_terms = stringr::str_trim(collected_all_disease_terms)
         ) 

```

## Final summary - number of unique study terms

```{r}

n_studies_trait = gwas_study_info |>
  dplyr::filter(DISEASE_STUDY == T) |>
  dplyr::select(collected_all_disease_terms, PUBMED_ID) |>
  dplyr::distinct() |>
  dplyr::group_by(collected_all_disease_terms) |>
  dplyr::summarise(n_studies = dplyr::n()) |>
  dplyr::arrange(desc(n_studies))

head(n_studies_trait)

dim(n_studies_trait)

```

### When separate studies with multiple terms 

```{r}

diseases <- stringr::str_split(pattern = ", ", 
 gwas_study_info$collected_all_disease_terms[gwas_study_info$collected_all_disease_terms != ""])  |> 
            unlist() |>
            stringr::str_trim()

length(unique(diseases))

```


## Save output

```{r save_output}

fwrite(gwas_study_info,
here::here("output/gwas_cat/gwas_study_info_disease_trait_filtered.csv"))

```
