---
title: "UK Biobank GWAS Studies: Cohorts and Bibliometric Analysis"
author: "Isobel Beasley"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(data.table)
library(dplyr)
library(ggplot2)
library(stringr)

```

# Overview / introduction:

I'm interested in identifying which studies use the same cohort/samples
in the GWAS catalogue. Why? To produce ancestry proportion information
that controls for the same samples (particularly big biobanks) being
reused many times.

Within the same research article, this will likely be easier to achieve
as:

-   Labelling of the cohort is likely to be consistent within the same
    research article (for e.g. one article will likely refer to UKBB
    samples as UKBB always, and not sometimes UK Biobank)

-   Many papers study the same cohort across diseases. Thus, this kind
    of cohort reuse can be identified by noticing that these papers have
    the same or similar sample sizes across diseases

-   Many papers use the same cohort/s, and then study particular
    subsamples and the overall cohort. This kind of sample reuse cohort
    can be identified when it involves, e.g. ancestry groups, as the
    overall study sample demographics are provided and can be matched to
    the study subsamples

-   (?) I believe the GWAS catalog somewhat reduces / identifys cohort
    overlap in the same study when producing ancestry metadata for the
    whole catalog

More recently, the GWAS catalog has allowed authors to supply cohort
label information (e.g. UK Biobank). However, this doesn't make it
necessarily easier to compare across studies as:

-   Not all studies provide cohort information/label (especially studies
    before this policy was implemented)

-   Studies inconsistency label the same cohort (e.g. UK Biobank is
    listed as UKBB, UKB etc.) - Many studies use multiple cohorts

I believe I will be able to identify when the same samples are used
across different research articles by matching sample sizes (e.g., does
their sample description match the cohort of the UK Biobank), citation
patterns (e.g., cite the UK Biobank dataset papers), etc. This will
likely require considering publication date, as the sample sizes of
biobanks/cohorts and the canonical dataset papers to cite will change
over time.

This page aims to investigate how feasible this analysis will be.

Specifically, for sample re-use in the same study:

-   Can I easily categorise it into: subsample use / testing, & re-use
    across disease?

-   Are there papers which don't match either of these categories?

For sample re-use across study:

-   How much missingness is there in cohort labelling?

-   Can I identify the UK Biobank dataset papers?

## 1. Load / pre-process GWAS Catalog data

```{r load_gwas}
# Load GWAS Catalog studies
# gwas_study_info <- fread(here::here("data/gwas_catalog/gwas-catalog-v1.0.3.1-studies-r2025-07-21.tsv"),
#                          sep = "\t", quote = "")
gwas_study_info <- fread(here::here("output/gwas_study_info_cohort_corrected.csv"))


gwas_ancest_info <-  fread(here::here("data/gwas_catalog/gwas-catalog-v1.0.3.1-ancestries-r2025-07-21.tsv"),
                         sep = "\t", quote = "")

# Standardize column names (remove spaces)
gwas_study_info <- gwas_study_info |>
  rename_all(~gsub(" ", "_", .x))

gwas_ancest_info <- gwas_ancest_info |>
  rename_all(~gsub(" ", "_", .x)) 

```
